// < !-- ===== PODCAST DATA ===== -->
const allPodcastData = [
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
  {
    thumbnail: "/assets/images/png/video-thumbnail.png",
    videoUrl: "https://www.youtube.com/embed/3JluqTojuME",
    title: "Odcinek 100: Metryki DORA – mit czy rzeczywistość?",
    description:
      "W tym odcinku gościmy Kingę Gaździńską z Grupy Pracuj i zanurzamy się w świat metryk DORA. Czy faktycznie przewidują przyszłość projektów IT, czy to tylko mit? Kinga rozwiewa wątpliwości i mówi, jak jest naprawdę – bez ściemy. Nie chcesz tego przegapić!",
    tags: ["#MetrykiDORA", "#DevOps", "#IT", "#ProjektyIT", "#KingaGaździńska"],
  },
];
const container = document.getElementById("all-podcast-container"),
  pagination = document.getElementById("pagination"),
  openSearchBtn = document.getElementById("open-search"),
  searchOverlay = document.getElementById("search-overlay"),
  searchBox = document.getElementById("search-box");
let currentPage = 1,
  currentPlaying = null,
  filteredData = [...allPodcastData];
const getItemsPerPage = () => (window.innerWidth < 768 ? 5 : 10);
let itemsPerPage = getItemsPerPage();
window.addEventListener("resize", () => {
  itemsPerPage = getItemsPerPage();
  renderPodcasts(currentPage);
});
function openOverlay() {
  searchOverlay.classList.remove("top-[-100%]");
  searchOverlay.classList.add("top-0");
  document.body.style.overflow = "hidden";
}
function closeOverlay() {
  if (searchOverlay.classList.contains("top-0")) {
    searchOverlay.classList.remove("top-0");
    searchOverlay.classList.add("top-[-100%]");
    document.body.style.overflow = "";
  }
}
openSearchBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  openOverlay();
});
searchOverlay.addEventListener("click", (e) => {
  if (!searchBox.contains(e.target)) closeOverlay();
});
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") closeOverlay();
});
window.addEventListener("scroll", () => {
  closeOverlay();
});
const buttonClass = (active) =>
  `md:w-[22px] md:h-5 w-[33px] h-[30px] rounded-[7.5px] md:rounded-[5px] flex items-center justify-center border text-xs leading-50 ${active ? "bg-orange text-black border-orange" : "text-orange border-orange"
  }`;
function createBtn(content, isActive, disabled, onClick) {
  const btn = document.createElement("button");
  btn.innerHTML = content;
  btn.className = buttonClass(isActive);
  btn.disabled = disabled;
  if (onClick) btn.onclick = onClick;
  return btn;
}

function renderPodcasts(page) {
  container.innerHTML = "";
  if (!filteredData.length) {
    container.innerHTML = `<p class="text-center text-white text-xl">Brak wyników.</p>`;
    pagination.style.display = "none";
    return;
  }
  const start = (page - 1) * itemsPerPage;
  filteredData.slice(start, start + itemsPerPage).forEach((data, index) => {
    const globalIndex = allPodcastData.indexOf(data);
    const card = document.createElement("div");
    card.className =
      "flex flex-col md:flex-row sm:gap-[30px] gap-5 lg:py-[20px] py-[27.5px] md:items-center justify-center";
    card.innerHTML = `
        <div class="relative video-wrapper md:max-w-max max-w-[330px]" data-index="${globalIndex}">
          <img src="${data.thumbnail}" alt="thumbnail"
            class="video-thumbnail rounded-[30px] md:max-w-[260px] max-md:max-w-[330px] max-md:w-full h-[195px]" />
          <img src="/assets/images/svg/play-btn.svg" alt="play"
            class="rounded-full cursor-pointer max-w-[44px] h-[44px] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 play-button" />
        </div>
        <div class="mb-0 max-lg:max-w-[550px]">
          <h2 class="font-tomorrow font-semibold lg:text-2xl text-xl !leading-119 text-orange lg:mb-[15px] mb-2.5 uppercase">${data.title
      }</h2>
          <p class="font-normal sm:text-sm text-xs text-white sm:!leading-119 !leading-125 md:mb-[15px] mb-2.5">${data.description
      }</p>
          <div class="flex flex-wrap items-center gap-1 lg:mb-[55px] mb-5">
            ${data.tags
        .map(
          (tag) =>
            `<span class="font-normal text-custom-xs sm:!leading-100 leading-120 text-orange">${tag}</span>`
        )
        .join("")}
          </div>
          <a href="/podcast.html">
            <button class="bg-white font-semibold text-custom-base leading-100 text-dark-black flex items-center gap-[9px] py-[3.5px] sm:pl-[4px] pl-[3.75px] pr-[18px] rounded-full lg:min-w-[181px] transition-all ease-linear duration-300 group">
              <div class="bg-orange size-[27px] flex justify-center items-center rounded-full group-hover:w-[36px] transition-all ease-linear duration-300">
                <img src="/assets/images/svg/arrow-icon.svg" class="rounded-full w-[17px] h-[15px]" />
              </div>
              Obejrzyj Podcast
            </button>
          </a>
        </div>`;
    container.appendChild(card);
  });
  renderPagination();
}
function renderPagination() {
  const total = Math.ceil(filteredData.length / itemsPerPage);
  pagination.innerHTML = "";
  if (total <= 1) return (pagination.style.display = "none");
  pagination.style.display = "flex";
  pagination.appendChild(
    createBtn(
      `<img src="./assets/images/svg/pagination-arrow.svg" alt="next" class="size-2 rotate-180" />`,
      false,
      currentPage === 1,
      () => currentPage > 1 && renderPodcasts(--currentPage)
    )
  );
  const addBtn = (i) =>
    pagination.appendChild(
      createBtn(i, i === currentPage, false, () => {
        currentPage = i;
        renderPodcasts(i);
      })
    );

  if (total <= 10) {
    for (let i = 1; i <= total; i++) addBtn(i);
  } else {
    const showDots = (val) =>
      pagination.appendChild(
        createBtn("...", false, false, () => {
          currentPage = val;
          renderPodcasts(val);
        })
      );

    if (currentPage <= 6) {
      for (let i = 1; i <= 8; i++) addBtn(i);
      showDots(9);
      addBtn(total);
    } else if (currentPage >= total - 5) {
      addBtn(1);
      showDots(total - 8);
      for (let i = total - 7; i <= total; i++) addBtn(i);
    } else {
      addBtn(1);
      showDots(currentPage - 3);
      for (let i = currentPage - 2; i <= currentPage + 2; i++) addBtn(i);
      showDots(currentPage + 3);
      addBtn(total);
    }
  }
  pagination.appendChild(
    createBtn(
      `<img src="./assets/images/svg/pagination-arrow.svg" alt="next" class="size-2" />`,
      false,
      currentPage === total,
      () => currentPage < total && renderPodcasts(++currentPage)
    )
  );
}
document.addEventListener("click", (e) => {
  const btn = e.target.closest(".play-button");
  if (!btn) return;

  const wrapper = btn.closest(".video-wrapper"),
    index = wrapper.getAttribute("data-index"),
    data = allPodcastData[index];

  if (currentPlaying && currentPlaying !== wrapper) {
    const i = currentPlaying.getAttribute("data-index"),
      d = allPodcastData[i];
    currentPlaying.innerHTML = `
        <img src="${d.thumbnail}" alt="thumbnail"
          class="video-thumbnail rounded-[30px] md:max-w-[260px] max-md:max-w-[330px] max-md:w-full h-[195px]" />
        <img src="/assets/images/svg/play-btn.svg" alt="play"
          class="rounded-full cursor-pointer max-w-[44px] h-[44px] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 play-button" />`;
  }
  wrapper.innerHTML = "";
  wrapper.classList.add("iframe-loading");
  const iframe = document.createElement("iframe");
  iframe.src = data.videoUrl + "?autoplay=1&rel=0";
  iframe.allow = "autoplay; encrypted-media";
  iframe.allowFullscreen = true;
  iframe.className =
    "rounded-[30px] md:max-w-[260px] max-md:max-w-[330px] max-md:w-full h-[195px]";
  iframe.onload = () => {
    wrapper.classList.remove("iframe-loading");
    wrapper.classList.add("iframe-loaded");
  };

  wrapper.appendChild(iframe);
  currentPlaying = wrapper;
});
document.querySelector("input[type='text']").addEventListener("input", (e) => {
  const query = e.target.value.toLowerCase();
  filteredData = allPodcastData.filter((p) =>
    p.title.toLowerCase().includes(query)
  );
  currentPage = 1;
  renderPodcasts(currentPage);
});
renderPodcasts(currentPage);