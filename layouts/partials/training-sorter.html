{{- /*
  Partial: training-sorter.html
  Description: Sorts trainings - future by closest date first, then past by most recent first
  Context: Map of all trainings
  Returns: Sorted slice of trainings
*/ -}}

{{- $today := now.Format "2006-01-02" -}}
{{- $futureTrainings := slice -}}
{{- $pastTrainings := slice -}}

{{- /* Separate trainings into future and past, adding firstDate field for sorting */ -}}
{{- range . -}}
  {{- if .dates -}}
    {{- $firstDate := index .dates 0 -}}
    {{- /* Add firstDate field to training object for proper sorting */ -}}
    {{- $training := merge . (dict "firstDate" $firstDate) -}}

    {{- if gt $firstDate $today -}}
      {{- $futureTrainings = $futureTrainings | append $training -}}
    {{- else -}}
      {{- $pastTrainings = $pastTrainings | append $training -}}
    {{- end -}}
  {{- else -}}
    {{- /* Trainings without dates go to the end */ -}}
    {{- $training := merge . (dict "firstDate" "") -}}
    {{- $pastTrainings = $pastTrainings | append $training -}}
  {{- end -}}
{{- end -}}

{{- /* Sort future trainings by firstDate ascending (closest first) */ -}}
{{- $sortedFuture := slice -}}
{{- if $futureTrainings -}}
  {{- $sortedFuture = sort $futureTrainings "firstDate" "asc" -}}
{{- end -}}

{{- /* Sort past trainings by firstDate descending (most recent first) */ -}}
{{- $sortedPast := slice -}}
{{- if $pastTrainings -}}
  {{- $sortedPast = sort $pastTrainings "firstDate" "desc" -}}
{{- end -}}

{{- /* Combine: future first, then past */ -}}
{{- $allSorted := $sortedFuture -}}
{{- range $sortedPast -}}
  {{- $allSorted = $allSorted | append . -}}
{{- end -}}

{{- return $allSorted -}}