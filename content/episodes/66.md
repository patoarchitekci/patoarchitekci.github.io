---
title: '#66 Patoarchitekci Short #22
'
date: 2023-03-17T08:00:00+02:00
episode: "66"
tags: ["database", "platform", "discord", "design"]
description: ""

# Jekyll compatibility fields (zachowane dla innych systemÃ³w)  
spreaker: 53222762
apple: "patoarchitekci-short-22/id1477067604?i=1000604610122"
spotify: "https://open.spotify.com/episode/5FOaZTrMcl2hvL9KWjgYUi"
youtube: "https://www.youtube.com/watch?v=zCoB81nc0os"

# Hugo fields  
youtube_id: "zCoB81nc0os"
youtube_url: "https://www.youtube.com/embed/zCoB81nc0os?enablejsapi=1"

# Social media images (poprawione nazwy)
og_landscape: "/img/66-landscape.webp"
og_square: "/img/66-square.webp"

# Intro for episode
intro: |
  Mamy dla Was nowe znaleziska! 
  Discord, Cassandra, Scylla, Spotify i nie tylko!
  

# Links for the episode
links:
  - title: "How Discord Stores Trillions of Messages"
    url: "https://discord.com/blog/how-discord-stores-trillions-of-messages"
  - title: "After the buzz fades: What our data tells us about emerging technology sentiment - Stack Overflow Blog"
    url: "https://stackoverflow.blog/2023/03/09/after-the-buzz-fades-what-our-data-tells-us-about-emerging-technology-sentiment/"
  - title: "Spotify Engineering Incident Report: Spotify Outage on January 14, 2023 Infrastructure - : Spotify Engineering"
    url: "https://engineering.atspotify.com/2023/02/incident-report-spotify-outage-on-january-14-2023/"

# Newsletter content (zachowane dla kompatybilnoÅ›ci)
newsletter: |
  CzeÅ›Ä‡! ğŸ‘‹ âœ¨
  
  Mamy dla Was nowe znaleziska! 
  Discord, Cassandra, Scylla, Spotify i nie tylko!
  
  
  
  
  ## Odcinek na stronie i materiaÅ‚y do niego â¬‡ï¸
  
  â¡ï¸ [OdsÅ‚uchaj na stronie](https://patoarchitekci.io/66)
  â¡ï¸ [Spotify](https://open.spotify.com/episode/5FOaZTrMcl2hvL9KWjgYUi)
  â¡ï¸ [Apple Podcasts](patoarchitekci-short-22/id1477067604?i=1000604610122)
  â¡ï¸ [YouTube](https://www.youtube.com/watch?v=zCoB81nc0os)
  
  ## Short & Sweet
  

  ### ğŸ¤ DoÅ‚Ä…cz do Discord ğŸ‘‰ [https://discord.gg/78zPcEaP22](https://discord.gg/78zPcEaP22)
  
  ### ğŸ¢ Patron odcinka
  SÅ‚uchasz PatoarchitektÃ³w dziÄ™ki PROTOPII â€“ firmie, w ktÃ³rej Åukasz i Szymon dziaÅ‚ajÄ… na co dzieÅ„, wspierajÄ…c zespoÅ‚y IT na kaÅ¼dym etapie: od projektowania, przez wdroÅ¼enia i migracje, aÅ¼ po optymalizacjÄ™ i zabezpieczenia. Oferujemy teÅ¼ mentoring i szkolenia dostosowane do potrzeb kaÅ¼dej firmy, niezaleÅ¼nie od wielkoÅ›ci. SprawdÅº nas: [protopia.tech](https://protopia.tech/)
  
  PS. Masz pytania? Pisz Å›miaÅ‚o po drugiej stronie to nie bot na bazie GPT czy Claude ğŸ˜
---

**Åukasz KaÅ‚uÅ¼ny**: CzeÅ›Ä‡. SÅ‚uchacie PatoarchitektÃ³w. ProwadzÄ… Åukasz KaÅ‚uÅ¼ny...

**Szymon Warda**: ...i Szymon Warda. Wszystkie linki do tego odcinka znajdziecie oczywiÅ›cie na patoarchitekci.io/66. Dobrze, Åukaszu, co tam masz w tej posusze?

**Åukasz KaÅ‚uÅ¼ny**: Powiedzmy tak - nudy chyba. ÅšmiejÄ…c siÄ™ z tego, Å¼e pewien bank sobie poleciaÅ‚ i nie bÄ™dziemy o tym dyskutowaÄ‡, ale powiÄ…zany z techem. MÃ³j feed zalaÅ‚o sporo treÅ›ci wÅ‚aÅ›nie wokÃ³Å‚ tego banku i zostawmy to w spokoju. WiÄ™c lecÄ…c... Taki wpis z Discorda: Discord opisaÅ‚ swojÄ… podrÃ³Å¼ i swoje problemy z przechowywaniem wiadomoÅ›ci. No i majÄ… po amerykaÅ„sku tryliony wiadomoÅ›ci, po naszemu miliardy. I teraz co jest tutaj? O tej historii: opowiedzieli wÅ‚aÅ›nie... CaÅ‚a historia ich leci od tego, Å¼e w 2015, w okolicach 2015 to byÅ‚o MongoDB do przechowywania, czyli lecieli po schemie NoSQLowej. JeÅ¼eli ktoÅ› zobaczy teÅ¼, jak wyglÄ…dajÄ… wiadomoÅ›ci ze Slacka, z innych takich rzeczy, jak wyglÄ…da wiadomoÅ›Ä‡, ktÃ³rÄ… piszemy, to zawsze jest to doÅ›Ä‡ sHTMLzowany maÅ‚y JSON. WiÄ™c MongoDB, potem Cassandra i od tego roku ScyllaDB w trybie Cassandry. W tym wpisie opisali swoje na poczÄ…tek problemy. W 2020 roku skoÅ„czyli z... Klaster do wiadomoÅ›ci miaÅ‚ 177 node'Ã³w i pokazane jest nawet, jak wyglÄ…da schemat tej tabeli od wiadomoÅ›ci. Nie jest ona duÅ¼a, ale zaczÄ™Å‚y ich boleÄ‡ odczyty i garbage collection, ktÃ³re wiÄ…Å¼e siÄ™ z tym przy Cassandrze, bo Cassandra ma bardzo

**Åukasz KaÅ‚uÅ¼ny**: ze wzglÄ™du na to, Å¼e korzysta z walla headloga, szybkiej replikacji, jest bardzo tania w zapisie. W odczycie jest bardzo droga i JVM w ich skali zaczynaÅ‚ im dawaÄ‡ po tyÅ‚ku i pauzy garbage collectora. I stwierdzili, Å¼e sprÃ³bujÄ… ze ScyllÄ…DB. Testy wyszÅ‚y poprawnie, pacjent przeÅ¼yÅ‚ i poszli na to tak naprawdÄ™, Å¼eby to byÅ‚a baza kompatybilna z CassandrÄ…, napisana w C++, Å¼eby nie trzeba byÅ‚o za bardzo wszystkiego wymieniaÄ‡ po drodze. Pokazali wÅ‚aÅ›nie caÅ‚oÅ›Ä‡ - jak podeszli do migracji danych. PodpowiadajÄ…c, napisali coÅ› w raÅ›cie, Å¼eby przeprowadziÄ‡ tÄ… migracjÄ™. W jaki sposÃ³b to obsÅ‚ugujÄ…? I teraz po wszystkim w koÅ„cÃ³wce patrzÄ…c siÄ™ co z tego uzyskali to skoÅ„czyli na 72 wÄ™zÅ‚ach.

**Szymon Warda**: To nie jest duÅ¼o.

**Åukasz KaÅ‚uÅ¼ny**: Czyli Å›ciÄ™li. NaprawdÄ™ to Å›ciÄ™li potÄ™Å¼nie w porÃ³wnaniu do Cassandry i pokazali odczyty - i to jest dla pobierania historycznych wiadomoÅ›ci. WczeÅ›niej P99 mieli na poziomie od 40 do 125 milisekund, na Cassandrze, na Scylli zjechali do 15 milisekund.

**Szymon Warda**: Mieli bardzo Å‚adne czasy, zjechali bardzo.

**Åukasz KaÅ‚uÅ¼ny**: Tak wiÄ™c to sÄ… - wiesz - przy tej skali to sÄ… Å›wietne. I co jest ciekawe, bo mieli wahajÄ…cÄ… siÄ™... Dla zapisÃ³w, dla insertÃ³w mieli te P99 wahajÄ…ce siÄ™ pomiÄ™dzy 5 a 70 milisekund na Cassandrze. I to jest ciekawe. Na Scylli majÄ… 5 milisekund. StaÅ‚e.

**Szymon Warda**: To jest super maÅ‚o.

**Åukasz KaÅ‚uÅ¼ny**: WiÄ™c...

**Szymon Warda**: Ale to brzmi aÅ¼ za dobrze jak sÅ‚ucham. CoÅ› mi tutaj wewnÄ™trznie nie gra.

**Åukasz KaÅ‚uÅ¼ny**: Pytanie jest tak, tam podeszli jeszcze gdzieÅ› jak szukaÅ‚em innych detali to byÅ‚o teÅ¼ np. przypinanie 1 core 1 shard i inne takie rzeczy, wiÄ™c doÅ›Ä‡ sporo optymalizacji pod spodem. No tak, ale jest to ciekawe i taki jeden z tego wniosek jest, Å¼e przy produktach, ktÃ³re majÄ… mieÄ‡ w przyszÅ‚oÅ›ci skalÄ™... Nie ma sensu zaopatrywaÄ‡ siÄ™ na tÄ… przyszÅ‚oÅ›Ä‡, bo i tak bÄ™dziesz ileÅ› razy zmuszony to wymieniÄ‡.

**Szymon Warda**: Czyli zawsze powtarzam ludziom, Å¼e pisanie czegoÅ› na skalÄ™ powiedzmy, z ktÃ³rÄ… bÄ™dziemy mieli za 4 lata, to nie ma sensu. De facto. Napiszmy coÅ›, co bÄ™dziemy mieli za rok albo za dwa max. Tak naprawdÄ™. Dowiemy siÄ™ duÅ¼o wiÄ™cej. Rynek siÄ™ rozwinie, pewne problemy zamiast my rozwiÄ…zywaÄ‡ bÄ™dziemy mogli po prostu wziÄ…Ä‡ z rynku, czasami w ogÃ³le jako opensource, wiÄ™c naprawdÄ™, nie ma sensu mÃ³wiÄ‡ "a co bÄ™dzie jeÅ¼eli nasza skala bÄ™dzie wynosiÅ‚a 100 razy wzglÄ™dem tego, gdzie jesteÅ›my? Nie, nie ma sensu.

**Åukasz KaÅ‚uÅ¼ny**: Zobacz, ta Cassandra to pokazuje, to ta Cassandra pokazaÅ‚a. ZaczÄ™li od 12 wÄ™zÅ‚Ã³w, 12-wÄ™zÅ‚owego klastra, ktÃ³ry miaÅ‚ juÅ¼ pierdyliard drobnicy.

**Szymon Warda**: Tak, ale faktyczny wpis jest doÅ›Ä‡ dokÅ‚adny generalnie, bo tam duÅ¼o rzeczy pozmieniali jeszcze, tam dodali jakiegoÅ› sqlite'a... Bardzo, bardzo, bardzo konkrety, bym powiedziaÅ‚. A co mnie w ogÃ³le zaciekawiÅ‚o i mnie ucieszyÅ‚o wÅ‚aÅ›nie? Opisywali, Å¼e dalej korzystajÄ… wÅ‚aÅ›nie z algorytmu snowflake'a od Twittera do generowania id-kÃ³w. A byÅ‚ moment, Å¼e byÅ‚o trochÄ™ fali hejtu na niego wylewane, a ja na przykÅ‚ad go lubiÄ™. TakÅ¼e naprawdÄ™, tak. Dobry, dÅ‚ugi wpis. Bardzo konkretny. NieÅºle. Tak. Spoko.

**Åukasz KaÅ‚uÅ¼ny**: Nie, w tej posusze, ktÃ³ra jest, jest naprawdÄ™ super. Nawet bez niej jest bardzo. Brakuje mi troszeczkÄ™ miÄ™sa, bo w niektÃ³rych, tak jak mÃ³wisz, fragmentach, wyglÄ…da za piÄ™knie. Jestem ciekaw Horror Stories z POCa, z migracji, z pierwszych problemÃ³w, kiedy to odpalili. To byÅ‚oby ciekawe. Takie wiesz, pierwsze dni na produkcji.

**Szymon Warda**: Tak, bo te liczby nie wyglÄ…dajÄ… za dobrze. To z reguÅ‚y jest tak, Å¼e mamy jakiÅ›... CoÅ› dostajemy, coÅ› oddajemy. De facto. I one naprawdÄ™ wyglÄ…dajÄ… aÅ¼ za dobrze, tym bardziej, Å¼e jeszcze odpalili to w trybie zgodnoÅ›ci, wiÄ™c to wyglÄ…daÅ‚oby na to, jakby musieli go do tego zmieniaÄ‡.

**Åukasz KaÅ‚uÅ¼ny**: Raczej Scylla tu to takie wiesz, zgodnoÅ›ci. Scylla ma teÅ¼ inny silnik pod spodem. WiÄ™c to teÅ¼, nie moÅ¼na powiedzieÄ‡, nazwaÄ‡ tego... To jest API tak naprawdÄ™, bo...

**Szymon Warda**: Tak, chodzi mi o API oczywiÅ›cie.

**Åukasz KaÅ‚uÅ¼ny**: Dobra. A Ty co masz?

**Szymon Warda**: Dobra, u mnie niewiele wÅ‚aÅ›nie. Ale rzecz... Drobna rzecz, ktÃ³ra mnie ucieszyÅ‚a. Spotify miaÅ‚o oczywiÅ›cie... WybuchÅ‚o im. I napisali, napisali i opublikowali Indicent Report. I co mnie ucieszyÅ‚o, Å¼e jest maÅ‚y i jest krÃ³tki. Nie, ale tak powaÅ¼nie, bo z reguÅ‚y incident reporty kojarzÄ… siÄ™ z wielkimi, wielkimi wpisami i Å¼e sÄ… bardzo zÅ‚oÅ¼one i zajmujÄ… duÅ¼o czasu i przez to maÅ‚o kto go w ogÃ³le robi. A tu jest mega prosty incident report, w ktÃ³rym sorry, naprawdÄ™ niewiele potrzeba wiÄ™cej. Jest opisane normalnymi sÅ‚owami: co siÄ™ staÅ‚o? W jakiej kolejnoÅ›ci? Potem jest timeline i potem jest podany jeszcze generalnie wykres, jaki to miaÅ‚o wpÅ‚yw i to jest koniec. I szukaÅ‚em lepszych linkÃ³w, ale jak ustaliliÅ›my niewiele siÄ™ w ogÃ³le dziaÅ‚o, ale do tego caÅ‚y czas mentalnie wracaÅ‚em. Bo jeÅ¼eli miaÅ‚bym komuÅ› daÄ‡ przykÅ‚ad na to, jaki incident report bym oczekiwaÅ‚, to de facto to. Bo to jest coÅ›, co moÅ¼na napisaÄ‡ w dwie godziny i wiÄ™cej nie potrzeba. A ja czÄ™sto widziaÅ‚em, jak wyciÄ…galiÅ›my.

**Åukasz KaÅ‚uÅ¼ny**: Jest szczery.

**Szymon Warda**: Tak. CzÄ™sto wyciÄ…galiÅ›my 4 stronicowy w Wordzie incident report. Nie ma sensu czegoÅ› takiego kleciÄ‡, bo to zajmie generalnie ludziom kilka dni. Nie oszukujmy siÄ™.

**Åukasz KaÅ‚uÅ¼ny**: Raczej, jest, powiem Ci tak - brakuje, bo to jest... Raczej, jeÅ¼eli patrzymy, bo to jest incident report, ale to nie jest RCA, bo teÅ¼ rozrÃ³Å¼nijmy, bo ludzie mogÄ…... Jak popatrzysz sobie, to to jest Å›wietny incident report, tak jak powiedziaÅ‚eÅ›, ale to nie jest Root Cause Analysis, gdzie masz bardziej szczegÃ³Å‚owo co wysiadÅ‚o i jak, ale tutaj jest w prostych sÅ‚owach.

**Szymon Warda**: Bym dyskutowaÅ‚, bo jest spory fragment wÅ‚aÅ›nie co siÄ™ wydarzyÅ‚o, jak siÄ™ wydarzyÅ‚o i tak dalej i tak dalej; nie ma trochÄ™ jak bÄ™dÄ… temu zapobiegaÄ‡, ale jest to wÅ‚aÅ›nie w tej sekcji What Happened, co siÄ™ wydarzyÅ‚o, jak to wyglÄ…daÅ‚o i zrozumienie co wyszÅ‚o. Faktycznie nie ma tego. Generalnie co zrobimy, Å¼eby tak wiÄ™cej nie byÅ‚o i tego roota wyszukania de facto.

**Åukasz KaÅ‚uÅ¼ny**: Nie, nie, wiesz, takich rzeczy tak. Wiesz, sÄ… technikalia, ktÃ³rych nie mogÄ… tutaj powiedzieÄ‡ teÅ¼ pewnie publicznie.

**Szymon Warda**: O tak, z tym bym siÄ™ zgodziÅ‚. Czy dla mnie to jest taki Å‚adny incident report? Tak samo jak zresztÄ… sÄ… ADRy, to w tej formie zdecydowanie incident reporty majÄ… dla mnie sens, bo: majÄ… sens, bo maÅ‚o czasu zajmÄ…, a dalej wiemy coÅ› - co siÄ™ wydarzyÅ‚o.

**Åukasz KaÅ‚uÅ¼ny**: Tak. Raczej brakuje potem, jeÅ¼eli ktoÅ› chce wejÅ›Ä‡ i potem zaklejaÄ‡ przyczynÄ™, no to jest juÅ¼ trochÄ™ mniej informacji. O tak.

**Szymon Warda**: ZgodzÄ™ siÄ™ jak najbardziej tak, ale...

**Åukasz KaÅ‚uÅ¼ny**: Nie, startowo jest po prostu genialny. Co siÄ™ staÅ‚o? Zatriggerowany maintenance na repo gotowym spowodowaÅ‚ wywalenie siÄ™ DNS'a. MiaÅ‚y byÄ‡ mechanizmy broniÄ…ce przed takimi sytuacjami, ale byÅ‚y nowe zmiany w komponencie DNS i mamy new failure mode...

**Szymon Warda**: Tak.

**Åukasz KaÅ‚uÅ¼ny**: Jak to okreÅ›lili, prosto z mostu bez Å¼adnych rzeczy.

**Szymon Warda**: CaÅ‚oÅ›Ä‡ mieÅ›ci siÄ™ z rysunkami, ze wszystkim, poniÅ¼ej jednej strony Worda de facto. Tak naprawdÄ™. WiÄ™c super.

**Åukasz KaÅ‚uÅ¼ny**: No.

**Szymon Warda**: PierdoÅ‚a, mnie cieszy. BÄ™dÄ™ miaÅ‚ link do wysyÅ‚ania w razie czego. Tyle.

**Åukasz KaÅ‚uÅ¼ny**: No to koÅ„czymy. Trzymajcie siÄ™.

**Szymon Warda**: To na razie.

**Åukasz KaÅ‚uÅ¼ny**: Na razie.

