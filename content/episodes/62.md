---
title: '#62 Architektura single i multi tenant
'
date: 2023-02-17T08:00:00+02:00
episode: "62"
tags: ["cloud", "architektura", "it"]
description: ""

# Jekyll compatibility fields (zachowane dla innych systemÃ³w)  
spreaker: 52754192
apple: "architektura-single-i-multi-tenant/id1477067604?i=1000600109555"
spotify: "https://open.spotify.com/episode/2ybFueVHVN4vPIDr1e2PEs"
youtube: "https://www.youtube.com/watch?v=txZuJ9ndEME"

# Hugo fields  
youtube_id: "txZuJ9ndEME"
youtube_url: "https://www.youtube.com/embed/txZuJ9ndEME?enablejsapi=1"

# Social media images (poprawione nazwy)
og_landscape: "/img/62-landscape.webp"
og_square: "/img/62-square.webp"

# Intro for episode
intro: |
  Multi-tenancy vs single-tenancy! Czyli m. in. implementacja pod B2C a B2B, sposoby implementacji, co w kodzie... a co w infrastrukturze? 
  

# Links for the episode
links:
  - title: "Multi-tenant SaaS patterns - Azure SQL Database  "
    url: "https://learn.microsoft.com/en-us/azure/azure-sql/database/saas-tenancy-app-design-patterns?view=azuresql"
  - title: "AWS re:Invent 2019: SaaS tenant isolation patterns"
    url: "https://www.youtube.com/watch?v=fuDZq-EspNA&ab_channel=AWSEvents"
  - title: "Definition of Multitenancy - IT Glossary  "
    url: "https://www.gartner.com/en/information-technology/glossary/multitenancy"
  - title: "Istio / JWT claim based routing"
    url: "https://istio.io/latest/docs/tasks/security/authentication/jwt-route/"
  - title: "How to integrate Hibernates Multitenant feature with Spring Data JPA in a Spring Boot application"
    url: "https://spring.io/blog/2022/07/31/how-to-integrate-hibernates-multitenant-feature-with-spring-data-jpa-in-a-spring-boot-application"
  - title: "Approaches to implementing multi-tenancy in SaaS applications  "
    url: "https://developers.redhat.com/articles/2022/05/09/approaches-implementing-multi-tenancy-saas-applications"
  - title: "Multi-tenancy - EF Core  "
    url: "https://learn.microsoft.com/en-us/ef/core/miscellaneous/multitenancy"
  - title: "SaaS Deep Dive: Designing and Building Multi-Tenant Solutions â€¢ Tod Golding â€¢ GOTO 2020"
    url: "https://www.youtube.com/watch?v=joz0DoSQDNw&t=1s&ab_channel=GOTOConferences"
  - title: "Tenancy model for SaaS applications - Azure Architecture Center  "
    url: "https://learn.microsoft.com/en-us/azure/architecture/isv/application-tenancy"

# Newsletter content (zachowane dla kompatybilnoÅ›ci)
newsletter: |
  CzeÅ›Ä‡! ğŸ‘‹ âœ¨
  
  Multi-tenancy vs single-tenancy! Czyli m. in. implementacja pod B2C a B2B, sposoby implementacji, co w kodzie... a co w infrastrukturze? 
  
  
  
  
  ## Odcinek na stronie i materiaÅ‚y do niego â¬‡ï¸
  
  â¡ï¸ [OdsÅ‚uchaj na stronie](https://patoarchitekci.io/62)
  â¡ï¸ [Spotify](https://open.spotify.com/episode/2ybFueVHVN4vPIDr1e2PEs)
  â¡ï¸ [Apple Podcasts](architektura-single-i-multi-tenant/id1477067604?i=1000600109555)
  â¡ï¸ [YouTube](https://www.youtube.com/watch?v=txZuJ9ndEME)
  
  ## Short & Sweet
  

  ### ğŸ¤ DoÅ‚Ä…cz do Discord ğŸ‘‰ [https://discord.gg/78zPcEaP22](https://discord.gg/78zPcEaP22)
  
  ### ğŸ¢ Patron odcinka
  SÅ‚uchasz PatoarchitektÃ³w dziÄ™ki PROTOPII â€“ firmie, w ktÃ³rej Åukasz i Szymon dziaÅ‚ajÄ… na co dzieÅ„, wspierajÄ…c zespoÅ‚y IT na kaÅ¼dym etapie: od projektowania, przez wdroÅ¼enia i migracje, aÅ¼ po optymalizacjÄ™ i zabezpieczenia. Oferujemy teÅ¼ mentoring i szkolenia dostosowane do potrzeb kaÅ¼dej firmy, niezaleÅ¼nie od wielkoÅ›ci. SprawdÅº nas: [protopia.tech](https://protopia.tech/)
  
  PS. Masz pytania? Pisz Å›miaÅ‚o po drugiej stronie to nie bot na bazie GPT czy Claude ğŸ˜
---

**Åukasz KaÅ‚uÅ¼ny**: CzeÅ›Ä‡. SÅ‚uchacie PatoarchitektÃ³w. ProwadzÄ… Åukasz KaÅ‚uÅ¼ny.

**Szymon Warda**: I Szymon Warda. Wszystkie linki oczywiÅ›cie na patoarchitekci.io/62. I przechodzimy do miÄ™sa, bo temat jest taki, gdzie dawno nie mieliÅ›my takiej kÅ‚Ã³tni z Åukaszem przed nagrywaniem. Multi-Tenancy czy Single-Tenancy? Problem jest taki: jak hostowaÄ‡ i jak stworzyÄ‡ infrastrukturÄ™ pod to, Å¼eby obsÅ‚ugiwaÄ‡ wielu klientÃ³w.

**Åukasz KaÅ‚uÅ¼ny**: Tak i teraz powiedzmy sobie o dwÃ³ch podejÅ›ciach, bo to byÅ‚a nasza najwiÄ™ksza kÅ‚Ã³tnia. Powiedzmy, sÄ… dwie perspektywy. Perspektywa operacyjno-biznesowa; To jest waÅ¼ny punkt, Å¼e potrafimy dostarczyÄ‡ nasz produkt dla wielu klientÃ³w jako usÅ‚ugÄ™. I to jest pierwszy punkt widzenia. Drugi punkt widzenia - jest to, czy architektonicznie jest to multi-tenancy. Tak, i to sÄ… dwa podziaÅ‚y. Dobra, przejdÅºmy sobie od razu do poziomÃ³w separacji, czyli w jaki sposÃ³b dokonujemy tego i sobie zaczniemy to tÅ‚umaczyÄ‡, te pojÄ™cia.

**Szymon Warda**: Dobrze. Najbardziej oczywisty jest taki, Å¼e dzielimy to w kodzie. Teraz co rozumiemy przez dzielimy to w kodzie? Czyli Å¼e mamy instancjÄ™ aplikacji, ktÃ³ra juÅ¼ w kodzie - dotnecie, czymkolwiek, Javie; na poziomie z reguÅ‚y jakiegoÅ› headera, z reguÅ‚y jakiegoÅ› tokenu, ktÃ³ry pobierze... Wybiera ten token i wszystkie requesty, o ktÃ³re bÄ™dzie zapytywaÅ‚a dane, bo te dane sÄ… najbardziej wraÅ¼liwe, bÄ™dzie robiÅ‚a z tym filtrem; z reguÅ‚y jakimÅ› Client ID albo coÅ› w tym stylu. Czyli de facto to developerzy odpowiadajÄ… za to, Å¼eby nie byÅ‚o dostÄ™pu z Tenanta A do danych Tenanta B.

**Åukasz KaÅ‚uÅ¼ny**: Czyli Tenant to jest dzierÅ¼awca po polsku Å‚adnie, czyli po prostu przestrzeÅ„ naszego klienta, ktÃ³rÄ… mu dedykujemy. WiÄ™c caÅ‚oÅ›Ä‡ i ta rzecz na poziomie kodu to rynkowo, architektonicznie, technologicznie to jest wÅ‚aÅ›nie to, co nazywamy multi-tenancy z punktu widzenia architektury, to jest takie istotne - z punktu widzenia architektury. Biznesowo to wszystko zaleÅ¼y od naszego modelu operacyjnego.

**Szymon Warda**: Tak, dla mnie podobnie np. jest teÅ¼ w fakturowniach albo jakiÅ› taki system Å›ledzenia faktur. To jest super, Å¼eby... Nie chcielibyÅ›my widzieÄ‡ faktur innej osoby, albo Å¼eby ktoÅ› widziaÅ‚ nasze faktury de facto.

**Åukasz KaÅ‚uÅ¼ny**: WrzuciÅ‚bym jeszcze Office'a 365 czy Google Workspace'a do tego worka.

**Szymon Warda**: Zgadza siÄ™ jak najbardziej. Dobrze. Kolejny poziom do separacji to sÄ… poziomy danych i tu mamy tak; albo mamy wszystko w jednej bazie i de facto tylko na poziomie tabeli... De facto mamy tam Client ID albo jakoÅ› wyciÄ…gamy na poziomie per schema, czyli mamy inne... Mamy inne prefiksy do schematÃ³w, ale same schematy w jednej bazie danych. I kolejny podziaÅ‚ to jest - mamy rÃ³Å¼ne bazy danych dla rÃ³Å¼nych tenantÃ³w. I jednÄ… rzecz dodam: tu ja uÅ¼yÅ‚em okreÅ›lenia bazy danych, ale to teÅ¼ moÅ¼e tyczyÄ‡ siÄ™ takich rzeczy jak storage'e. Rzeczy, generalnie, ogÃ³lno szeroko pojÄ™tych danych. Key vaultÃ³w itd. WiÄ™c wszystkiego co zapisujemy de facto.

**Åukasz KaÅ‚uÅ¼ny**: Tak, i model, jeÅ¼eli popatrzymy sobie, implementacyjny to tu jest bardzo waÅ¼ny podziaÅ‚ - czy to jest B2C czy B2B, czyli to jest czy klient koÅ„cowy jest takim Kowalskim. WeÅºmy aka Gmail - czy klient jest w jakimÅ› bardzo dedykowanym specyficznym sofcie typu bitu B2B. I o co chodzi? W przypadku takiego typowego B2C nie mamy Å¼adnego podziaÅ‚u, bo chcemy jak najbardziej przerzuciÄ‡ to na kod, Å¼eby byÅ‚o jak najtaÅ„sze. Jak najbardziej kombinowaÄ‡ z infrastrukturÄ… pod spodem. JeÅ¼eli chodzi o rozwiÄ…zania typu B2B i te multi-tenancy z poziomu kodu przyjmuje siÄ™ takie zaÅ‚oÅ¼enie, Å¼e jeÅ¼eli mamy multi-tenancy na poziomie kodu to zazwyczaj ten podziaÅ‚ powinien byÄ‡ per baza danych.

**Szymon Warda**: TrochÄ™, trochÄ™ jeszcze wybiegasz, trochÄ™ wybiegasz od tego jak to powinno byÄ‡, ale jeszcze - bo mieliÅ›my dalszy temat gdzie to faktycznie nie jest poziomem separacji, ale ja to nazywam poziomem upewnienia siÄ™, Å¼e ta separacja w porzÄ…dku generalnie. Albo jeÅ¼eli mamy pewne modele, czyli moÅ¼emy jeszcze mieÄ‡ rozmowÄ™ czy nasz compute, faktyczne maszyny wirtualne, czyli one sÄ… wspÃ³Å‚dzielone, czy kaÅ¼dy ma swoje wydzielone maszyny. I tutaj sÅ‚uszna uwaga Åukasza generalnie, Å¼e to juÅ¼ ma sens tylko i wyÅ‚Ä…cznie przy B2B jeÅ¼eli nasz klient wystawia pokaÅºne faktury. I kolejna opcja czy separujemy sieci tak naprawdÄ™, czy upewniamy siÄ™, Å¼eby Tenant A nie byÅ‚ w stanie wykonaÄ‡ Å¼adnego requestu do sieci Tenanta B.

**Åukasz KaÅ‚uÅ¼ny**: Tak, i to juÅ¼ sÄ… dedicated tenanty albo single tenanty.

**Szymon Warda**: Tak, zgadza siÄ™.

**Åukasz KaÅ‚uÅ¼ny**: I to jest taka istotna rzecz, czyli te dwie: pierwsza opcja - kod oznacza, Å¼e to jest architektoniczny multi-tenant, a to co byÅ‚o powiedziane wÅ‚aÅ›nie z computem, z dedykowanymi deploymentami, wdroÅ¼eniami to sÄ… single-ten anty. Ale mÃ³wimy nasza firma oferuje produkt jako usÅ‚uga.

**Szymon Warda**: Tak. Åukasz chce byÄ‡ bardzo poprawny jeÅ¼eli chodzi o definicjÄ™. Ja trochÄ™ mniej na niÄ… patrzÄ™, dobra. Teraz idziemy na sposoby implementacji. W kodzie... PowiedzieliÅ›my sobie juÅ¼ jak to dziaÅ‚a, wiÄ™c teraz na poziomie platformy i tu mamy kilka opcji. MoÅ¼emy sobie na poziomie... BÄ™dziemy czÄ™sto powoÅ‚ywali siÄ™ na Kubernetesa, bo tamte pojÄ™cia sÄ… znane i mniej wiÄ™cej najczÄ™Å›ciej takie platformy bÄ™dÄ… robione na Kubernetesie w jakiejÅ› odmianie. Podejrzewam. MoÅ¼emy na ingressie porozdzielaÄ‡ sobie Å‚adnie, moÅ¼emy na poziomie jakiegoÅ› Service Mesha wydzielaÄ‡ na poziomie requestÃ³w z headerÃ³w, kierowaÄ‡ ruch odpowiednio do odpowiednich instancji i moÅ¼emy teÅ¼ robiÄ‡ to na poziomie DNS'Ã³w. Czyli jak klient siÄ™ u nas rejestruje, dostaje odpowiedniego CName'a, jakÄ…Å› subdomenÄ™ i przez to de facto juÅ¼ na poziomie takim wejÅ›cia naszego systemu; jest odpowiednio kierowany do innych de facto instancji naszej aplikacji.

**Åukasz KaÅ‚uÅ¼ny**: I zabawa polega na tym, Å¼e Ingress i Mesh de facto obsÅ‚ugujÄ… albo tÄ… opcjÄ™ DNS'owÄ…, albo dedykowanego URL'a, albo rozszycie odpowiednio headera z tokenem i ze wszystkim co potrzebuje.

**Szymon Warda**: Rozszycie, bo to mesh jest na poziomie rozszycia defacto tak naprawdÄ™. Tak, zgadza siÄ™.

**Åukasz KaÅ‚uÅ¼ny**: W locie, a Ingress na wejÅ›ciu to rozszywa, bo w obydwu moÅ¼emy uzyskaÄ‡ to samo.

**Szymon Warda**: DNS teÅ¼ jest o tyle fajny, Å¼e potencjalnie on umie przykryÄ‡ to, czy... TakÄ… wersjÄ™ najgorszÄ…. To, czy dany tenant ma ma swojego namespace'a czy ma swÃ³j klaster de facto. On daje nam to, Å¼e dla super wielkich klientÃ³w moÅ¼na powiedzieÄ‡: Masz osobny klaster i Å›migasz tam.

**Åukasz KaÅ‚uÅ¼ny**: Tak, dokÅ‚adnie - i nie bawisz siÄ™ teÅ¼ w routing tego jeszcze przed, czyli jakiÅ›... BramkÄ™ wyjÅ›ciowÄ… na caÅ‚oÅ›Ä‡ i rozszywanie.

**Szymon Warda**: Tak i teÅ¼ geo bardzo wiele rzeczy potencjalnie potrafi Å‚adnie przykryÄ‡ tylko dla duÅ¼ych klientÃ³w. Nie oszukujmy siÄ™. OstatniÄ… rozmowÄ…, ktÃ³ra jest to jest rozmowa jak bardzo dzielimy compute i czy wystarczy podzieliÄ‡  compute tak naprawdÄ™, czy kaÅ¼dy duÅ¼y tenant ma swÃ³j dedykowany klaster, czy jednak separacja na poziomie dedykowanych nodegrup wystarcza tak naprawdÄ™? No i tutaj moÅ¼e byÄ‡ kaÅ¼dy... KaÅ¼de ma swoje plusy.

**Åukasz KaÅ‚uÅ¼ny**: Tak, pÃ³jdziemy sobie... Powiedzmy sobie, jak bardzo krytycznÄ… rzecz robimy, bo to chyba trzeba spojrzeÄ‡ z tej perspektywy. Powiedzmy sobie szczerze - to zaleÅ¼y, jak bardzo moÅ¼emy zostaÄ‡ teÅ¼ zaatakowani, bo to teÅ¼ trzeba sobie popatrzeÄ‡ z tej perspektywy, albo jak bardzo kiepsko implementujemy Kubernetesa, bo jeÅ¼eli robimy dedykowane nodegrupy przykÅ‚adowo, czyli wydzielamy dla klienta na klastrze dedykowanym nodegrupy. Oznacza to, Å¼e w teorii umiemy coÅ› w Kubernetesa, bo powinniÅ›my zrobiÄ‡ to np. jeÅ¼eli mÃ³wimy o hostowaniu tego na Kubernetesie, bo powinniÅ›my umieÄ‡ uÅ¼yÄ‡ network policy, namespace'Ã³w i innych takich elementÃ³w. Co oznacza, Å¼e z mojej perspektywy; poza tym, Å¼e jeÅ¼eli to sÄ… rzeczy zasoboÅ¼erne w CPU i musimy robiÄ‡ tam quality of service taki mocny, to de facto no... Nie ma to sensu. Lepiej juÅ¼ jeÅ¼eli w szczegÃ³lnoÅ›ci hostujemy siÄ™ w cloudzie, lepiej jest kolokowaÄ‡ to ze sobÄ….

**Szymon Warda**: OK. Bo teraz powoli wychodzi nam inna perspektywa, z ktÃ³rej patrzymy de facto. Ja patrzÄ™ z perspektywy tego: czy ufam moim deweloperom, Å¼eby siÄ™ nie machnÄ™li i Å¼eby przetestowali poprawnie, Å¼e naprawdÄ™ wszystkie requesty nie idÄ… do innego tenanta, albo Å¼e przez przypadek np. ktoÅ› z cache'a - to jest teÅ¼ opcja budujemy cache'e wiadomo, dla kaÅ¼dego z reguÅ‚y jakieÅ› dane cache'owe bÄ™dÄ… i ktoÅ› nagle mi pobierze wszystkie klucze z cache'a. Bo deweloperzy lokalni - nie oszukujmy siÄ™ - bÄ™dÄ… testowali to na jednym tenancie. Nie zmusimy ich, Å¼eby lokalnie testowali to na wielu tenantach. WiÄ™c szansa, Å¼e ten taki maÅ‚y bÅ‚Ä…d brak - jednego ifa albo innego enda albo jednego where'a spowoduje nam wyciek danych, bo to w tej perspektywie mnie przeraÅ¼a najbardziej... Jest doÅ›Ä‡ duÅ¼a dla mnie i nie ufam. Patrzmy na tÄ… rÃ³Å¼nicÄ™: Åukasz zdecydowanie woli mieÄ‡ to w jednym serwisie na poziomie kodu, bo dawno juÅ¼ deweloperami chyba nie pracowaÅ‚. Natomiast ja duÅ¼o czÄ™Å›ciej i mÃ³wiÄ™: nie ma tej opcji, ta separacja dla mnie jest duÅ¼o bardziej waÅ¼niejsza. I teÅ¼ moÅ¼e dlatego, Å¼e bardziej sektor finansowy tak naprawdÄ™.

**Åukasz KaÅ‚uÅ¼ny**: Ale dobra, zejdÅºmy sobie, wrÃ³Ä‡my do tego poszczegÃ³lnego wÅ‚aÅ›nie. JeÅ¼eli masz wydzielanie dedykowanych instancji compute'a w jednym klastrze np. Kubernetesowym, to w mojej perspektywie jeÅ¼eli musisz to zabezpieczyÄ‡, to poza tym, Å¼e potrzebujÄ™ dedykowanÄ… moc obliczeniowÄ…, to jeÅ¼eli ktoÅ› mi ucieknie z workloadu czy cokolwiek siÄ™ stanie - to i tak moÅ¼e pohasaÄ‡ po caÅ‚ym klastrze.

**Szymon Warda**: Zgadza siÄ™, dla mnie dedykowane nodegrupy de facto sÄ… o tyle problematyczne, Å¼e w tym momencie totalnie nie oszczÄ™dzamy i nie robimy wiÄ™kszej utylizacji tego, za co pÅ‚acimy, czyli naszych maszyn wirtualnych.

**Åukasz KaÅ‚uÅ¼ny**: Mamy dwa problemy w jednym.

**Szymon Warda**: Tak. I co wiÄ™cej - i to jest kosztowy de facto jeden element, ale drugi to jest taki, Å¼e jak nam coÅ›... mamy np. najwiÄ™kszy klaster, mamy duÅ¼y klaster, ale zaÅ‚Ã³Å¼my, kaÅ¼dy klient ma, nie wiem, trzy maszyny wirtualne; to de facto tam mamy bardzo niski poziom Resiliency. Nawet jak nam tam jedna wirtualka padnie to node'y siÄ™ nie... Czy workloady siÄ™ nie przerzucÄ… na inne wirtualki i to nie ma wiÄ™kszego sensu de facto.

**Åukasz KaÅ‚uÅ¼ny**: ProÅ›ciej mieÄ‡ 30-node'owy klaster, niÅ¼ klaster pociÄ™ty na dziesiÄ™Ä‡ takich przestrzeni.

**Szymon Warda**: Tak dokÅ‚adnie, bo to jest po prostu bardziej odporne i to ma wiÄ™kszy sens, a przy odpowiedniej skali rzeczy bÄ™dÄ… siÄ™ dziaÅ‚y. I niestety co z tego, Å¼e bÄ™dziemy mieli wielki klaster; jeÅ¼eli padniÄ™cie jednej maszyny wyÅ‚Ä…cza nam usÅ‚ugÄ™ dla innego klienta.

**Åukasz KaÅ‚uÅ¼ny**: Dobra, potem ten dedykowany klaster no to jak klient za to pÅ‚aci; No to wtedy idziemy w takie rzeczy.

**Szymon Warda**: Tak, dokÅ‚adnie, to to juÅ¼ wymagaÅ‚oby, jak to ty Å‚adnie okreÅ›lasz - wysokiego poziomu paranoi, Å¼e klient faktycznie niczemu nie ufa i musi byÄ‡.

**Åukasz KaÅ‚uÅ¼ny**: Raczej... Tak, jedna rzecz, ktÃ³rÄ… moÅ¼na zapewniÄ‡. To jest feature biznesowy. To nazwijmy, taka przewaga, feature technologiczny, ktÃ³ry dajemy. JeÅ¼eli mamy takie dedykowane np. klastry, mÃ³wimy, Å¼e: drogi kliencie, w ogÃ³le dedykowane compute'y, inne rzeczy, np. "drogi kliencie, moÅ¼emy zaszyfrowaÄ‡ dane Twoimi kluczami."

**Szymon Warda**: Jest jeszcze jeden case, ktÃ³ry ja teÅ¼ widujÄ™ zapotrzebowanie na takie przypadki; Å¼e tworzymy manage service, czyli tworzymy serwis, ktÃ³ry generalnie... mÃ³wimy Klientowi: okej, zdeployujemy go u Ciebie z subskrypcji, bo tak czasami bezpieczeÅ„stwo chce, ale my nim zarzÄ…dzamy i w tym momencie mamy osobny klaster, bo on jest poza naszÄ… subskrypcjÄ…, my nim zarzÄ…dzamy. Faktycznie jest osobny. To jest teÅ¼ czasami Å¼yczenie biznesowe tak naprawdÄ™, Å¼e to siÄ™ pojawia i ma to swoje zastosowanie z punktu widzenia bezpiecznikÃ³w; powiedzmy sobie szczerze - dla krytycznych systemÃ³w.

**Åukasz KaÅ‚uÅ¼ny**: Dobra. Kolejny sposÃ³b to jest miksowanie tego wszystkiego.

**Szymon Warda**: Tak. Czyli moÅ¼emy miksowaÄ‡ serwisy, Å¼e niektÃ³re serwisy dzielÄ… w aplikacji, gdzieniegdzie mamy per workload'y, a gdzieniegdzie mamy w ogÃ³le podzielone juÅ¼ instancje pod rÃ³Å¼nych klientÃ³w de facto - i to jest teÅ¼ czÄ™sty przypadek. To ja bym teraz doszedÅ‚ do tego, bo jeÅ¼eli mÃ³wimy o wspÃ³Å‚dzieleniu, to trochÄ™ zamienimy kolejnoÅ›Ä‡, o ktÃ³rej mieliÅ›my mÃ³wiÄ‡, to czÄ™sto takimi elementami wspÃ³Å‚dzielonymi... to ja widujÄ™ dwa: API Gateway/ Ingressy i STS, czyli serwisy uwierzytelniajÄ…ce. Pytanie teraz do Ciebie: wspÃ³Å‚dzielisz czy nie wspÃ³Å‚dzielisz?

**Åukasz KaÅ‚uÅ¼ny**: Ingressy tak. Raczej, inaczej. Infrastruktura taka techniczna, wejÅ›ciowa, sieciowa - jak najbardziej tak. Z STS'ami jest problem co jest tym STSem? Bo tak jak powiedziaÅ‚eÅ›; ja mam jeszcze, w zaleÅ¼noÅ›ci czy to jest STS pudeÅ‚kowy, to jest jakaÅ› usÅ‚uga, czy to jest kolejna nakÅ‚adka na przykÅ‚ad na Identity Server czy inne javowe odpowiedniki.

**Szymon Warda**: Åukasz, zdradzÄ™ Ci sekret. I to i to pisali deweloperzy.

**Åukasz KaÅ‚uÅ¼ny**: Nie ale bardziej chodzi mi o potem... Poziom implementacji. Tak jak Ty mÃ³wisz, Å¼e nie wierzysz w upilnowanie dobre kodu na multi-tenancy w kodzie, Å¼e wymaga lepszej jakoÅ›ci developerÃ³w, ktÃ³rzy sÄ… Å›wiadomi tego, co piszÄ….

**Szymon Warda**: Znaczy, dla mnie tam ryzyko gÅ‚upiego bÅ‚Ä™du  - bo sÄ… gÅ‚upie bÅ‚Ä™dy - jest ogromne; i co wiÄ™cej: reimplementacji tego samego w kaÅ¼dej aplikacji - jeÅ¼eli akurat mÃ³wimy o aplikacjach takich... Nazwijmy to mikroserwisowych... Jest zbyt drogie, to jest naprawdÄ™ kosztowne.

**Åukasz KaÅ‚uÅ¼ny**: Dobra, jeÅ¼eli popatrzysz, to ja za to nie ufam deweloperom - jeÅ¼eli chodzi o elementy uwierzytelniajÄ…ce, jeÅ¼eli to nie jest pudeÅ‚ko.

**Szymon Warda**: Ale oczywiÅ›cie...

**Åukasz KaÅ‚uÅ¼ny**: WiÄ™c tak, STS dla mnie jest taki, jeÅ¼eli to jest implementacja pudeÅ‚kowa i my tylko zakÅ‚adamy tam uÅ¼ytkownikÃ³w, pobieramy tokeny i inne rzeczy; spoko, moÅ¼e byÄ‡ wspÃ³Å‚dzielona. JeÅ¼eli ktoÅ› znowu kolejny raz popeÅ‚niÅ‚ jakÄ…Å› mocno zcustomizowanÄ… nakÅ‚adkÄ™, to no fucking way, wolÄ™ to mieÄ‡ osobno.

**Szymon Warda**: Zdefiniujmy, bo mÃ³wisz pudeÅ‚kowa - czy przez pudeÅ‚kowa, rozumiesz np. Azure AD?

**Åukasz KaÅ‚uÅ¼ny**: Tak.

**Szymon Warda**: Okej.

**Åukasz KaÅ‚uÅ¼ny**: Na przykÅ‚ad Azure AD B2C gotowe, oAuthy, Okta, AWS Cognito bodajÅ¼e. Zawsze mi siÄ™ ta nazwa myli, wiÄ™c bÄ™dzie... Czy jestem...

**Szymon Warda**: Identity Service? PudeÅ‚ko, czy nie pudeÅ‚ko wg. Ciebie?

**Åukasz KaÅ‚uÅ¼ny**: JeÅ¼eli jest w wersji teraz tej komercyjnej, pudeÅ‚kowej, gdzie tylko do niego strzelam po API; wstrzykujÄ™ konfiguracjÄ™ to tak. A jeÅ¼eli ktoÅ› dorobiÅ‚ tam swoje znowu... Sporo swojej logiki i kodu dorobiÅ‚ do tego to wolÄ™ mieÄ‡ to dedykowane.

**Szymon Warda**: OK, to ja widzÄ™ pewnÄ… prawidÅ‚owoÅ›Ä‡ w tym co mÃ³wisz. To, Å¼e toÅ¼samoÅ›Ä‡ i STSy, ktÃ³re sami hostujemy to temu nie ufasz, a to gdzie strzelamy do usÅ‚ugi de facto ufasz. I ja bym siÄ™ z tym zgodziÅ‚. Tak, dla mnie to przy tym podziale... MoÅ¼emy dyskutowaÄ‡ jak najbardziej.

**Åukasz KaÅ‚uÅ¼ny**: Tak, o - z opensource'u myÅ›laÅ‚em o Keycloak'u, bo teÅ¼ ludzie kombinujÄ… z nim, wiÄ™c jak Keycloak jest z pudeÅ‚eczka uÅ¼ywany przez API - super, jeÅ¼eli coÅ› wykombinowaliÅ›my ponad to - to dedykowane.

**Szymon Warda**: Dobra, a wspÃ³Å‚dzielenie serwisÃ³w platformowych?

**Åukasz KaÅ‚uÅ¼ny**: SÅ‚uchaj, platformowych... JeÅ¼eli popatrzymy - teraz jest pytanie, jeÅ¼eli mamy rzeczy, ktÃ³re nie siÄ™gajÄ… w zaleÅ¼noÅ›ci jak to nazwiesz teraz platformowym, bo to jest...

**Szymon Warda**: Blogowanie, metryki, wszystko co de facto nie dotykajÄ… siÄ™ developerzy z teamÃ³w typowo takich biznesowych.

**Åukasz KaÅ‚uÅ¼ny**: Inaczej; tak, moÅ¼emy wspÃ³Å‚dzieliÄ‡. Pytanie jest... Jak mÃ³wimy o poziomie paranoi, bo metryki tak, ta caÅ‚a platformÃ³wka, tak. Z logami pytanie jest zawsze jedno - czy dane klientÃ³w tam trafiajÄ…, czy tylko ID-ki.

**Szymon Warda**: To siÄ™ zgadza, Å¼eby nie byÅ‚o... Zgadzam siÄ™ z tym podejÅ›ciem, nawet powiem wiÄ™cej. Dla mnie platformowe sÄ… zdecydowanie do Å‚Ä…czenia, bo szczegÃ³lnie to juÅ¼ wychodzi chyba powoli z tej rozmowy, Å¼e ja jednak jestem za separacjÄ… serwisÃ³w tak naprawdÄ™, bo jak powiedziaÅ‚em - nie ufam i to jest zbyt drogie. Dlatego przy takiej iloÅ›ci serwisÃ³w te metryki, logi itd. MuszÄ… byÄ‡ poÅ‚Ä…czone. Ale zgodzÄ™ siÄ™ z TobÄ… de facto; co siÄ™ daje w sytuacji jak klient powie Å¼e nie, nie, nie - moje logi sÄ… zbyt wraÅ¼liwe i tak dalej i Å¼e trzeba to podzieliÄ‡. Wtedy klient pÅ‚aci wiÄ™cej po prostu i mamy osobne Grafany, osobne Loki i tak dalej, dalej. Podzielone serwisy platformowe? Dla mnie nie. ZarÄ…biemy siÄ™ z operations po prostu, zbyt drogie to bÄ™dzie.

**Åukasz KaÅ‚uÅ¼ny**: Nie, nie, to trzeba teÅ¼ podzieliÄ‡: infrastruktura... WydzieliÄ‡ poziom infra, a poziom tych dedykowanych tenantÃ³w, single tenantÃ³w na tej infrastrukturze.

**Szymon Warda**: Dobrze, to chyba warpujemy to. Twoja GOAT metoda, Å¼e tak powiem.

**Åukasz KaÅ‚uÅ¼ny**: Ona jest - I teraz kÅ‚adÄ™ mÃ³j sposÃ³b myÅ›lenia: nowy produkt, nowy produkt w zaleÅ¼noÅ›ci od okreÅ›lenia, ale to jest kod + podziaÅ‚... Dobranie modelu podziaÅ‚u danych.

**Szymon Warda**: Zdefiniuj dobranie modelu podziaÅ‚u danych.

**Åukasz KaÅ‚uÅ¼ny**: Czyli B2C... W ogÃ³le zapominamy. Jeden wspÃ³lny worek.

**Szymon Warda**: To siÄ™ zgadzamy, jak najbardziej.

**Åukasz KaÅ‚uÅ¼ny**: B2B. To jest wykorzystanie podziaÅ‚u per wÅ‚aÅ›nie wydzielanie kontenerÃ³w, baz danych i innych takich elementÃ³w.

**Szymon Warda**: OK.

**Åukasz KaÅ‚uÅ¼ny**: I to jest takie way to go dla nowej aplikacji. I teraz bardzo waÅ¼ne, co podkreÅ›lam, dla nowej aplikacji. Dlatego jak przerabiamy jakiÅ› produkt, Å¼eby firma zaczÄ™Å‚a Å›wiadczyÄ‡ as a service - i tak skoÅ„czymy na single-tenantach. Tak wiÄ™c zrÃ³bmy po prostu tÄ… infrÄ™ dobrze.

**Szymon Warda**: OK, to ja siÄ™ tu nie zgodzÄ™. Czyli zgodzÄ™ siÄ™ czÄ™Å›ciowo i czÄ™Å›ciowo siÄ™ nie zgodzÄ™. Separacja baz danych - jak najbardziej w kaÅ¼dym wymiarze i powinniÅ›my mieÄ‡ osobne bazy danych dla klienta, choÄ‡by procedury backupu. Wszystko bÄ™dzie po prostu Å‚atwiejsze. ZresztÄ… klient jest teÅ¼ super kluczem partycji tak naprawdÄ™, wiÄ™c taniej bÄ™dzie nam mieÄ‡ nawet zaÅ‚Ã³Å¼my te 500 baz; niÅ¼ jednÄ… bazÄ™, ktÃ³ra bÄ™dzie miaÅ‚a dane z 500 tenantÃ³w. Ale jednak jeÅ¼eli mÃ³wimy - ja bym tu powiedziaÅ‚ inaczej, jeÅ¼eli byÅ›my mieli jakieÅ› takie bardziej monolityczne systemy; duÅ¼e, takie wielkie, wielkie systemy, to tam na poziomie kodu bym siÄ™ moÅ¼e zastanowiÅ‚. Tak naprawdÄ™... Bo to moÅ¼na by ogarnÄ…Ä‡ jakiÅ› sposÃ³b. BÄ™dziemy mieli na tyle duÅ¼o tej infrastruktury, Å¼e de facto bÄ™dzie nas staÄ‡ na zbudowanie tej infrastruktury takiej aplikacyjnej w kodzie, ktÃ³ra by to filtrowaÅ‚a zawsze. Natomiast jeÅ¼eli mamy cokolwiek bardziej serwisowego, mamy tych serwisÃ³w wiÄ™cej, to reimplementacja tego samego kawaÅ‚ka logiki odnoÅ›nie tenantowoÅ›ci i na wszystkie requesty... To jest tak piekielnie drogie. I tak ryzykowne. CiÄ™Å¼kie w testach. Zdecydowanie ja jestem tu za dzieleniem: serwisy per tenant. Czysto kosztowo i wzglÄ™dem ryzyka.

**Åukasz KaÅ‚uÅ¼ny**: Znaczy tak, moÅ¼na tu sobie popatrzeÄ‡, chociaÅ¼ teraz dotnet core teraz to raczej dotnet. Przepraszam, peÅ‚en dotnet teraz, bo muszÄ™ siÄ™ odzwyczaiÄ‡ od tego, Å¼e jest dotnet core teraz... GdzieÅ› tam na swoim poziomie juÅ¼ np. pomaga z tym. Tak samo Spring Boot teÅ¼ zaczyna to... PomagaÄ‡ nam tworzyÄ‡ takie rzeczy.

**Szymon Warda**: Bez dwÃ³ch zdaÅ„ tak. Jak mam tych serwisÃ³w duÅ¼o, to widzÄ™, Å¼e jakieÅ› wspÃ³lne biblioteki, one siÄ™ starzejÄ… super szybko. O tym mÃ³wiliÅ›my de facto juÅ¼ nie raz.

**Åukasz KaÅ‚uÅ¼ny**: Nie, sÅ‚uchaj, dlatego mÃ³wiÄ™, Å¼e rzeczy wbudowane w frameworki, a nie nasze wspÃ³Å‚dzielone biblioteki.

**Szymon Warda**: PrzecieÅ¼ i tak to zostanie obudowane, i tak to zostanie obudowane w jakiegoÅ› frameworka. No nie oszukujmy siÄ™.

**Åukasz KaÅ‚uÅ¼ny**: Dobra, czyli koÅ„czÄ…c... KaÅ¼dy z nas ma innÄ… opiniÄ™.

**Szymon Warda**: Agree to disagree. DokÅ‚adnie tak.

**Åukasz KaÅ‚uÅ¼ny**: DokÅ‚adnie. Trzymajcie siÄ™.

**Szymon Warda**: Na razie. Hej.

**Åukasz KaÅ‚uÅ¼ny**: Hej!

