---
title: '#3 Kubernetes (chyba?) dla architektÃ³w
'
date: 2019-08-30T08:00:00+02:00
episode: "3"
tags: []
description: ""

# Jekyll compatibility fields (zachowane dla innych systemÃ³w)  
spreaker: 22177745
apple: ""
spotify: "https://open.spotify.com/episode/"
youtube: ""

# Hugo fields  
youtube_id: ""
youtube_url: ""

# Social media images (poprawione nazwy)
og_landscape: "/img/3-landscape.webp"
og_square: "/img/3-square.webp"

# Intro for episode
intro: |
  MiÄ™so od 16:24, za bardzo siÄ™ rozgadaliÅ›my na wstÄ™p! ;-)
  
  Temat odcinka to Kubernetes z dwÃ³ch punktÃ³w widzenia â€“ osoby piszÄ…cej aplikacji oraz osoby dostarczajÄ…cej Kuberentes jako platformÄ™.
  

# Links for the episode
links:
  - title: "Clearbit&#39;s approach to management"
    url: "https://blog.clearbit.com/managers-handbook-tldr/"
  - title: "Mature Microservices and How to Operate Them"
    url: "https://www.infoq.com/presentations/microservices-financial-times"
  - title: "Esencjalista - Greg McKeown"
    url: "http://lubimyczytac.pl/ksiazka/274606/esencjalista"
  - title: "A Very Cold Take on IBM, Red Hat and Their Hybrid Cloud Hyperbole"
    url: "https://www.platformonomics.com/2019/07/a-very-cold-take-on-ibm-red-hat-and-their-hybrid-cloud-hyperbole/"

# Newsletter content (zachowane dla kompatybilnoÅ›ci)
newsletter: |
  CzeÅ›Ä‡! ğŸ‘‹ âœ¨
  
  MiÄ™so od 16:24, za bardzo siÄ™ rozgadaliÅ›my na wstÄ™p! ;-)
  
  Temat odcinka to Kubernetes z dwÃ³ch punktÃ³w widzenia â€“ osoby piszÄ…cej aplikacji oraz osoby dostarczajÄ…cej Kuberentes jako platformÄ™.
  
  
  
  
  ## Odcinek na stronie i materiaÅ‚y do niego â¬‡ï¸
  
  â¡ï¸ [OdsÅ‚uchaj na stronie](https://patoarchitekci.io/3)
  â¡ï¸ [Spotify](https://open.spotify.com/episode/)
  â¡ï¸ [Apple Podcasts](#)
  â¡ï¸ [YouTube](#)
  
  ## Short & Sweet
  

  ### ğŸ¤ DoÅ‚Ä…cz do Discord ğŸ‘‰ [https://discord.gg/78zPcEaP22](https://discord.gg/78zPcEaP22)
  
  ### ğŸ¢ Patron odcinka
  SÅ‚uchasz PatoarchitektÃ³w dziÄ™ki PROTOPII â€“ firmie, w ktÃ³rej Åukasz i Szymon dziaÅ‚ajÄ… na co dzieÅ„, wspierajÄ…c zespoÅ‚y IT na kaÅ¼dym etapie: od projektowania, przez wdroÅ¼enia i migracje, aÅ¼ po optymalizacjÄ™ i zabezpieczenia. Oferujemy teÅ¼ mentoring i szkolenia dostosowane do potrzeb kaÅ¼dej firmy, niezaleÅ¼nie od wielkoÅ›ci. SprawdÅº nas: [protopia.tech](https://protopia.tech/)
  
  PS. Masz pytania? Pisz Å›miaÅ‚o po drugiej stronie to nie bot na bazie GPT czy Claude ğŸ˜
---

**Szymon Warda [SW]**: Jestem ciekawy, jak reszta ludzi patrzy, bo patrzÄ…c na Kubernetesa z tych dwÃ³ch stron, moÅ¼emy mieÄ‡ rÃ³Å¼ne kompletnie spojrzenia...

**Åukasz KaÅ‚uÅ¼ny [ÅK]**: Tak. I rÃ³Å¼ne opinie. 

**SW:** Tak. I czÄ™sto jak nie zdefiniujemy tego spojrzenia, to potem nie do koÅ„ca wiadomo, z ktÃ³rego punktu siÄ™ wychodzi. Dobra, to moÅ¼e, od czego siÄ™ zaczÄ™Å‚o? Kubernetes. 

**ÅK:** Od site projectu w Google'u. I teraz, co waÅ¼ne, wzoruje siÄ™ na BORGu, czyli na internalowym systemie, internalowym workload schedulerze z Google'a. Panowie siÄ™ nim inspirowali, wzorowali, nie wziÄ™li kod base'u, czyli kawaÅ‚ek napisali. No i wÅ‚aÅ›nie sam BORG sÅ‚uÅ¼y juÅ¼ od dawien dawna do puszczania w duÅ¼ej skali workloadÃ³w, jobÃ³w. I duÅ¼Ä… odmianÄ… od takiego Kubernetesa tam jest to, Å¼e uÅ¼ywamy binare i fatbinare. Zamiast kontenerÃ³w schcedulujemy juÅ¼ binarki, no i to, co duÅ¼e firmy chcÄ… osiÄ…gnÄ…Ä‡. Oni tym BORGiem chcieli osiÄ…gnÄ…Ä‡ jak najwiÄ™ksze utylizacje tych procesÃ³w, zrobiÄ‡ high-density. Czyli tam, gdzie u normalnych ludzi Å›wieci siÄ™ "critical", u nich jest to normalne, dobrze doutylizowane serwery. 

**SW:** Tak, ale ja mam dwie obserwacje. Bo tak naprawdÄ™, jeÅ¼eli mÃ³wimy o BORGu, swojÄ… drogÄ… zdecydowanie Star Trek over Star Wars, dla tych, ktÃ³rzy Å‚apiÄ… analogie, to takie samo podejÅ›cie parÄ™ lat pÃ³Åºniej zrobiÅ‚ Microsoft ze swoim serwisem Fabric'iem. 

**ÅK:** Wiesz, co? Nie do koÅ„ca. Serwis Fabric to teÅ¼ byÅ‚a pewna platforma i pierwszy koncept, i pierwszych Coat Base powstaÅ‚ w 2001 roku serwis Fabrica.

**SW:** MyÅ›laÅ‚em, Å¼e pÃ³Åºniej.

**ÅK:** Nie, 2005 to juÅ¼ byÅ‚ dziaÅ‚ajÄ…cy produkt. 

**SW:** OK, dobra, to ja skojarzyÅ‚em to z piÄ…tkÄ…. 

**ÅK:** Tak, wiÄ™c 2001. Projekt iHome, czyli robili Smart City Zenita. Ludzie o tym mÃ³wili, a oni robili software pod to. 

**SW:** OK, dobra. Ale dla mnie przede wszystkim to drugie, a propos utylizacji, to z drugiej strony jak mÃ³wimy o utylizacji, to sÄ… niÅ¼sze koszty, wiÄ™c niÅ¼sze koszty teÅ¼ dla nas, ale to teÅ¼ jest sposÃ³b, w jaki powstaÅ‚ caÅ‚y ten caÅ‚y Serverless, to jest sposÃ³b na dopchanie tych maszyn o dodatkowe 10% tak naprawdÄ™, wiÄ™c chmura jest biznesem. On musi siÄ™ opÅ‚acaÄ‡ temu, kto wystawia i temu, kto kupuje. Pokazuje to, w jaki sposÃ³b przy tak duÅ¼ej skali, jest prÃ³ba wyniesienia pewnych serwisÃ³w do poziomu infrastruktury, Å¼eby to byÅ‚o coÅ›, co juÅ¼ jest zapewniane. CaÅ‚e Discovery, o czym jeszcze bÄ™dziemy mÃ³wili tak naprawdÄ™, caÅ‚a warstwa komunikacji synchronicznej... Jest pchanie doÅ›Ä‡ mocne, OK, to nie powinno byÄ‡ powtarzane, reodkrywane w kaÅ¼dym projekcie. 

**ÅK:** Tak, masz opis tak naprawdÄ™, robisz abstrakcjÄ™ tak naprawdÄ™ nad infrastrukturÄ… i jÄ… opisujesz, wiÄ™c to jest troszeczkÄ™ chyba teÅ¼ w twoim tym, w jaki sposÃ³b utrzymaÄ‡ aplikacjÄ™.

**SW:** Tak, w jaki sposÃ³b utrzymaÄ‡. Czym mniej bÄ™dzie elementÃ³w castomowych w danym systemie, tym Å‚atwiej bÄ™dzie jÄ… utrzymaÄ‡. JeÅ¼eli Discovery zawsze wyglÄ…da tak, jest Å‚atwiej. Nikt nie chce utrzymywaÄ‡ Service Discovery sprzed 15 lat, bo to dziaÅ‚a inaczej niÅ¼ teraz.

**ÅK:** Tak. Jak jesteÅ›my trochÄ™ przy utrzymaniu aplikacji historycznie, no to chyba dla mnie w sumie, jak dla ciebie - tu siÄ™ zgadzamy. Z tego, co wiem, to jest sposÃ³b opisu.

**SW:** Fenomenalny! Tym mnie w ogÃ³le kupiÅ‚ Kubernetes wÅ‚aÅ›nie! I co jest waÅ¼ne, to... Ten opis juÅ¼ mieliÅ›my w Docker Compose'ie, w pewien sposÃ³b. Nie byÅ‚ tak dobry. 

**ÅK:** Tak, Docker Compose byÅ‚ jednostkowy, a w przypadku Kubernetesa to mamy coÅ›, co ja na szkoleniach siÄ™ staram wytÅ‚umaczyÄ‡, Å¼e mamy reconciliation loop, czyli mamy stan obecny i stan poÅ¼Ä…dany, czyli Kubernetes z tej perspektywy wÅ‚aÅ›nie, jak zarzÄ…dzamy aplikacjÄ…, on dÄ…Å¼y do tego stanu, Å¼eby byÅ‚ opisany przez nas manifest, czy to bÄ™dzie Jan czy Jason, dÄ…Å¼yÅ‚ wÅ‚aÅ›nie tego stanu. 

**SW:** Tak, dla mnie Compose siÄ™ sprawdza fenomenalnie do stawiania projektÃ³w na jednej maszynie. Nastawianie na wielu? Nie, to nie dziaÅ‚aÅ‚o aÅ¼ tak dobrze. Compose restartami i tak dalej prÃ³bowaÅ‚ dodaÄ‡ funkcjonalnoÅ›Ä‡, nie tylko jak system inicjalnie powinien wyglÄ…daÄ‡, ale jak powinien wyglÄ…daÄ‡ przez caÅ‚y swÃ³j cykl Å¼ycia. Ale Kubernetes tu pozamiataÅ‚. I opis, i dziaÅ‚anie selektorÃ³w i tak dalej, to po prostu dziaÅ‚a dobrze. 

**ÅK:** Jest fajny wywiad z zeszÅ‚ego roku z jednym z wspÃ³Å‚twÃ³rcÃ³w, z Brandonem Berensem. On teraz pracuje w Microsoft, bo przeszedÅ‚ do Microsoftu parÄ™ lat temu. No i w wywiadzie jest bardzo fajna rzecz. To, co on myÅ›li, taka ambicja twÃ³rcÃ³w tego byÅ‚a trochÄ™, teraz na to patrzÄ… tak, Å¼e opisy Kubernetesa stanÄ… siÄ™ takim X86 zestawem instrukcji 86 czy armowych dla cloud-native. Czyli Å¼e nie patrzÄ… juÅ¼ na Kubernetesa jak na platformÄ™ do hostowania apek, ale ta rzecz, ktÃ³ra najlepsza siÄ™ teraz zdarzyÅ‚a, czyli te manifesty... Å»e one stanÄ… siÄ™ jakby zestawem instrukcji, ktÃ³ry zostanie reuÅ¼yty i zaimplementowany w innych miejscach. 

**SW:** To dochodzimy do tego, gdzie ja siÄ™ bardzo z tego powodu cieszÄ™, bo ten zestaw opisu wÅ‚aÅ›nie, jak to wyglÄ…da, zawiera teÅ¼ rzecz, ktÃ³ra dla mnie byÅ‚a przeÅ‚omowa, jak zaczÄ…Å‚em Kubernetes. ZaczÄ…Å‚em siÄ™ nim bawiÄ‡, uÅ¼ywaÄ‡, to byÅ‚o OK i fajnie, fajnie, wszystko jest OK. A potem uÅ¼yÅ‚em deploymentÃ³w i zobaczyÅ‚em jak Kubernetes z pudeÅ‚ka implementuje canary deployment. Jak majÄ…c trzy maszynki, on wpierw wdroÅ¼y na trzy pody, wpierw wdroÅ¼y na 1 pod, sprÃ³buje, pobierze obraz, dopiero jak to siÄ™ uda, to wgra, jak nie, to bÄ™dzie pobieraÅ‚. Deploymenty - to w Kubernetesie po prostu jest super. Ten, kto pisaÅ‚ deploymenty w PowerShellu, Bashu, w czymkolwiek - widziaÅ‚em tysiÄ…ce linii kodu deploymentu, deploymenty sÄ… trudne, a w procesie po prostu to dziaÅ‚a. Jest to element wyglÄ…du systemu, jest element tego, jak system powinien dziaÅ‚aÄ‡, poniewaÅ¼ wdroÅ¼enie jest elementem Å¼ycia systemu, wiÄ™c jako Å¼ycie jest zapisywane przez odpowiednie atrybuty: ile, jak, kiedy moÅ¼e ubiÄ‡, kiedy moÅ¼e byÄ‡ wiÄ™cej maszyn. 

**ÅK:** Deploymenty tak. DrugÄ… rzecz, ktÃ³rÄ… widzÄ™ tam: wystarczy naprawdÄ™ bardzo maÅ‚o, Å¼eby robiÄ‡ je dobrze. Nawet zero data deploymenty. Jedynie, co tak naprawdÄ™ najwaÅ¼niejsze, to nie uÅ¼ywaÄ‡ ORMa i troszeczkÄ™ poÅ¼yczyÄ‡ bazy relacyjne.

**SW:** O czym powiemy, tak, zgadza siÄ™. To coÅ› jeszcze, bo powiedziaÅ‚eÅ›, Å¼e - i to bÄ™dzie motyw przewodni tak naprawdÄ™ w Kubernetesie, Å¼e tam wiele rzeczy na starcie jest zrobionych po prostu dobrze. Ten deployment, ktÃ³ry jest, to jest Å‚adny Canary, nie jest idealny, ale z reguÅ‚y bÅ‚Ä™dy w deploymencie spowodowane sÄ… tym, Å¼e czegoÅ› nie uÅ¼yliÅ›my, na przykÅ‚ad nie uÅ¼yliÅ›my odpowiednich progÃ³w, health checkÃ³w itd., nie ustawiliÅ›my, ile moÅ¼e maszyn ubiÄ‡, to dziaÅ‚a dobrze! Ty zauwaÅ¼aÅ‚eÅ›, Å¼e zrobienie tam CACD jest po prostu proste.

**ÅK:** Tak. I to jest duÅ¼a zaleta teÅ¼ Kubernetesa, Å¼e manifesty sÄ… niezaleÅ¼ne od jÄ™zyka. 

**SW:** Tak! 

**ÅK:** Czyli jeÅ¼eli wiesz, jak danÄ… aplikacje skonteneryzowaÄ‡, to juÅ¼ sama filozofia na Kubernetesie, oczywiscie \*bo teraz mÃ³wimy troszkÄ™ kÅ‚amstwa dla dzieci, bo sÄ… pewne tam niuanse, ale na ogÃ³Å‚ jest to proste. 

**SW:** Tak, jest to proste.

**ÅK:** Powtarzalne...

**SW:** Powtarzalne, przyjemne. To, co trochÄ™ mnie boli, to jest to, Å¼e jak siÄ™ szuka w sieci (mam nadziejÄ™, Å¼e wasz kurs to naprawi), to bardzo duÅ¼o jest definicji, jak to zrobiÄ‡ z konsoli, nie z plikÃ³w. Wklepanie danych w Kubernetesie z poziomu konsoli jest niewykorzystywaniem potÄ™gi, jakÄ… daje Kubernetes, jakÄ… dajÄ… pliki. 

**ÅK:** Tak, jest tam jeszcze inna filozofia, ale o tym pÃ³Åºniej. Z tym siÄ™ zgodzÄ™ siÄ™, Å¼e powinniÅ›my korzystaÄ‡ z manifestÃ³w albo czegoÅ›, co generuje te manifesty. 

**SW:** Tak!

**ÅK:** O, moÅ¼e tak to wezmÄ™. Tak, coÅ›, co bÄ™dzie trzymane w repo. 

**SW:** Dobra, mam jeszcze jednÄ… rzecz jeÅ›li chodzi o Kubernetesa, takiego z poziomu aplikacyjnego, co zahaczyliÅ›my. Ile Kubernetes usÅ‚ug wyciÄ…gnÄ…Å‚ jako commodity. Tak naprawdÄ™ te usÅ‚ugi nie sÄ… idealne, o czym teÅ¼ sobie powiemy. Ale przede wszystkim mega proste: Service Discovery.

**ÅK:** Tak.

**SW:** Bardzo prosty API Gateway. Inicjalnie moÅ¼emy sobie robiÄ‡ load balancing. MoÅ¼emy wybieraÄ‡, moÅ¼emy dywersjonowaÄ‡. Selektory i metadane, ktÃ³re sÄ… obecne na kaÅ¼dym nodzie, do ktÃ³rego moÅ¼na siÄ™ odwoÅ‚aÄ‡, powodujÄ…, Å¼e z takÄ… prostÄ… ideÄ…, sÄ… w stanie niesamowicie fajne rzeczy robiÄ‡. 

**ÅK:** Tak, czyli zacznijmy moÅ¼e od tego jeszcze, jak dziaÅ‚a Service Discovery, bo jak juÅ¼ poruszyÅ‚eÅ›, Å¼e robili do commodity, no to mamy te dwie opcje. Jedna to jest taka wÅ‚aÅ›nie ta najprostsza, o ktÃ³rej mÃ³wisz, czyli walimy po DNSie, tak jak nazywa siÄ™ nasza usÅ‚uga plus Namespace, gdzie sÄ… dostÄ™pne w klastrze i moÅ¼emy siÄ™ po prostu odwoÅ‚ywaÄ‡ i koniec. 

**SW:** Przez serwis Node'a. 

**ÅK:** Tak, przez serwis. I to jest super rzecz i bÄ™dzie good enough chyba dla wiÄ™kszoÅ›ci przypadkÃ³w. 

**SW:** W wiÄ™kszoÅ›ci z tego, co widzÄ™ to jest chyba more than good enough nawet. 

**ÅK:** Tak. Druga opcja, jak chcemy zrobiÄ‡ coÅ› zaawansowanego, bo chciaÅ‚byÅ› popytaÄ‡ siÄ™ wÅ‚aÅ›nie o labelach po metadanych, siÄ™ zaczyna to pokrywaÄ‡. No to juÅ¼ musimy siÄ™ zintegrowaÄ‡ z API Kubernetesowemu. 

**SW:** Pozostaje ten obszar, gdzie nie komunikujemy siÄ™ bezpoÅ›rednio synchronicznie, tylko po prostu chcemy coÅ› siÄ™ dowiedzieÄ‡... To tam, to zaczyna byÄ‡ tricky. ZgodzÄ™ siÄ™ jak najbardziej. 

**ÅK:** Tak, tam to jest takie trochÄ™ chyba... Z notatek twÃ³j komentarz, czyli jak chcemy zaczÄ…Ä‡ kombinowaÄ‡, to moÅ¼e zewnÄ™trzne Service Discovery. Jak chcemy robiÄ‡ coÅ› bardziej skomplikowanego. 

**SW:** Tak! No bo jeÅ¼eli potrzebujemy takich rzeczy jak Key Vaulta, a bÄ™dziemy potrzebowali czegoÅ› do sekretÃ³w... No to pytanie, czy w tym momencie wÅ‚aÅ›nie nie potrzebujemy czegoÅ› zewnÄ™trznego, jak Consul, Ajour, Key Vault, cokolwiek innego. Pytanie, czy warto wÅ‚aÅ›nie walczyÄ‡ z Kubernetesem, czy jednak zewnÄ™trznego jako normalny serwis i zadziaÅ‚a. 

**ÅK:** Z mojej perspektywy, praca z wiÄ™kszÄ… iloÅ›ciÄ… klastrÃ³w, jest tak, Å¼e jeÅ¼eli twoja apka nie wychodzi z potrzebami poza klaster, to ten podstawowy wystarcza w zupeÅ‚noÅ›ci. 

**SW:** Ja bym teÅ¼ tak powiedziaÅ‚. A pytanie, jak jest ze wsparciem dla sekretÃ³w i Key Vaulta? 

**ÅK:** Wiesz co? Nie Å‚adujesz zewnÄ™trznie same secrety od strony, tak jak patrzÄ™ wÅ‚aÅ›nie, dostarczania platforma aplikacji. No to, te domyÅ›lne juÅ¼ teraz, w zaleÅ¼noÅ›ci, gdzie trzymamy tego Kubernetesa, ale moÅ¼na zaszyfrowaÄ‡ te secrety pod spodem.

**SW:** Faktycznie, byÅ‚a opcja...

**ÅK:** Czyli mogÄ… byÄ‡ juÅ¼ szyfrowane pod spodem. Czy w cloudowych jest teraz duÅ¼o providerÃ³w, ktÃ³re podpinajÄ… zewnÄ™trzne, czyli na przykÅ‚ad Key Vault aÅ¼urowy moÅ¼e byÄ‡ zamontowany jako volumen. Secrety mogÄ… byÄ‡ zamontowane jako volumen. Czy z innÄ… opcjÄ…, tak jak mÃ³wimy o konsoli HashiCorp, no to sÄ… pluginy, ktÃ³re robiÄ… auto injecting z Vaulta do poda. WiÄ™c jest ileÅ› tych fajnych opcji, ktÃ³re sÄ…, jeÅ¼eli chodzi o secrety. 

**SW:** Dobra, to ja dorzucÄ™ obszar, co mnie trochÄ™ martwi, co bÄ™dziemy rozwijali, to jest to, Å¼e overhead Kubernetesa jest duÅ¼y. Kubernetes to jest 2,5 miliona linii kodu. To jest duÅ¼o. Jak ja wÅ‚Ä…czam na moim laptopie, to nagle to jest 45% zuÅ¼ycia procesora, ktÃ³ry w tej wersji jeszcze nie ma Å¼adnej aplikacji. To jest tak - rzucam, odwoÅ‚amy siÄ™, trochÄ™ chyba nie z twojego punkty widzenia. 

**ÅK:** Dobra. MojÄ… tezÄ… jest to, Å¼e nadaje siÄ™ do budowy platform. I dla mnie to jest super rzecz kiedy jest dostarczany w jakiÅ› sposÃ³b jako kompleksowy ofering. Przez to rozumiem na przykÅ‚ad wziÄ™cie klastra as a servise od jakiegoÅ› vendora z GKE czy z Azura. Bierzemy ten klaster i dostajemy do niego caÅ‚Ä… tÄ™ potrzebnÄ… otoczkÄ™. Bo wÅ‚aÅ›nie to, co trochÄ™ powiedziaÅ‚aÅ›, Kubernetes ma swÃ³j poziom wyobraÅ¼enia, Å¼e jest skomplikowany, niby ma teÅ¼ overhead, co jest prawdÄ… i nieprawdÄ…, bo sam Kubernetes jest tylko orchiestratorem. 

**SW:** Zgadza siÄ™.

**ÅK:** I to gÅ‚upim jak budowa cepa, to jest taka moja perspektywa. 

**SW:** Zgadza siÄ™.

**ÅK:** WiÄ™c trochÄ™ mit... Repo jest duÅ¼e, teraz sÄ… prace, ktÃ³re mÃ³wiÄ…, Å¼e pewne rzeczy sÄ… wyodrÄ™bniane, bo rozwÃ³j Kubernetesa, to teÅ¼ istotne, przez dÅ‚ugi czas byÅ‚o to tak naprawdÄ™ wszystko pchane do jednego repa, jeÅ¼eli chodzi o kod. I tam znajdujÄ… siÄ™ np. integracje third-party, tak jak z Azurem, AWSem, VMwarem i innymi rzeczami. One znajdujÄ… siÄ™ natywnie sobie w corcode'dzie, a teraz sÄ… wyrzucane jako zewnÄ™trzny moduÅ‚, wiÄ™c duÅ¼a czÄ™Å›Ä‡ bÄ™dzie schodziÅ‚a. Tam jest parÄ™ takich nawet w repo fajnych plikÃ³w, tak jak od volumenÃ³w. ProszÄ™ tego nie przerabiaÄ‡, jeden plik jest najbardziej czytelny i nie rozbijajcie tego. Jest taki stary, klasyczny inÅ¼ynierski "if" - "jeÅ¼eli coÅ›" i leci zduplikowany kod, i nikt siÄ™ tym nie przejmuje, i siÄ™ nie dotyka.

**SW:** Ale z czego wynika ten "if". Ten "if" wynika z jakiegoÅ› bugu, ktÃ³ry znaleÅºli i ktÃ³ry jest naprawiony. I kaÅ¼dy system, ktÃ³ry jest uÅ¼ywany produkcyjnie, zbiera taki "szlam" realiÃ³w jego uÅ¼ycia.

**ÅK:** W szczegÃ³lnoÅ›ci tak szeroko. No i druga rzecz, to z punktu widzenia platformy aplikacji teÅ¼, bo jest nice to have to mieÄ‡. No to mamy ten caÅ‚y ekosystem Cloud Native Foundation. No i te Cloud Native Foundation to jest fundacja opensource'owa zaÅ‚oÅ¼ona przez Linux Foundation, czyli tÄ™ fundacjÄ™, ktÃ³ra utrzymuje kernel i tutaj sÄ… rozwijane projekty, nazwijmy to krytycznej infrastruktury i biblioteki, rozwiÄ…zania caÅ‚e cloudnative'owe. WiÄ™c to nie jest tylko Kubernetes, ale moÅ¼emy znaleÅºÄ‡ masÄ™ rzeczy, ktÃ³ra jest w ogÃ³le nie zwiÄ…zana z Kubernetes, ale siÄ™ integruje. MoÅ¼emy wziÄ…Ä‡ Fluentd do forwardowania logÃ³w, ktÃ³re Microsoft wykorzystuje to pod spodem w swoim agencie do wypychania logÃ³w, na przykÅ‚ad z LinuxÃ³w czy Metrek. InnÄ… rzeczÄ… bÄ™dzie NATS, czyli bardzo szybka, nowoczesna kolejka do IoT, ktÃ³ra potrafi przepychaÄ‡ setki tysiÄ™cy jednoczesnych poÅ‚Ä…czeÅ„, wiÄ™c caÅ‚y ten Å›wiat jest bardziej szeroki.

**SW:** Pytanie pozostaje takie, na ile, z punktu widzenia znowu mojego, na ile moÅ¼na liczyÄ‡, Å¼e bÄ™dzie rozdzielany Kubernetes od caÅ‚ego CNCFa? No bo Kubernetes jest sprzedawany jako taki produkt pudeÅ‚kowy, ktÃ³ry jest zaopiniowanym Stackiem, bo tam to, co powiedziaÅ‚eÅ›, kryje siÄ™ zestaw technologii, ktÃ³re sÄ… skonfigurowane, ktÃ³re z sobÄ… Å‚adnie dziaÅ‚ajÄ…. Czy to jest problem poznawczy generalnie, jak jest sprzedawany? Czy jak jest widziany? Bo pod nazwÄ… Kubernetes kryje siÄ™ wszystko.

**ÅK:** Tak jest, wszystko. A dla mnie to jest tylko orchiestrator. To, co mÃ³wisz, caÅ‚y ekosystem - tak, jest waÅ¼ny, potrzebujesz tych funkcjonalnoÅ›ci. Tylko z drugiej strony moÅ¼esz wziÄ…Ä‡ sobie wÅ‚aÅ›nie cloudowÄ… rzecz, ktÃ³ra dostarcza wokÃ³Å‚ te usÅ‚ugi funkcjonalnoÅ›ci czy, to co na poczÄ…tku wspomnieliÅ›my, OpenShifta. Czyli moÅ¼esz wziÄ…Ä‡ dystrybucje, ktÃ³re to wszystko majÄ… i one nie zawsze majÄ… klocki z CNCFu.

**SW:** Pytanie, jak w dÅ‚ugiej perspektywie, czy nagle nie bÄ™dÄ… smaki Kubernetesa, Kubernetes z tymi klockami i z tymi... Czy nie bÄ™dzie dziaÅ‚aÅ‚ inaczej, czy nie bÄ™dÄ… rÃ³Å¼nice? Tego siÄ™ trochÄ™ bojÄ™.

**ÅK:** Wiesz co? TroszeczkÄ™ to siÄ™ teraz uspokoiÅ‚o, bo Kubernetes jest, jak sobie popatrzÄ™ na rozwÃ³j funkcjonalnoÅ›ci, ktÃ³re dochodzÄ…, to zwolniÅ‚o. On siÄ™ stabilizuje i dojrzewa teraz. JesteÅ›my juÅ¼ na takim etapie stabilizacji i dojrzewania, czyli bardziej jest sprzÄ…tanie, uspÃ³jnianie, repo stylu kodowania czy budowa nowej infrastruktury do testÃ³w CACD wewnÄ…trz samego projektu Kubernetesowego.

**SW:** I budowanie poparcia biznesowego dla niego teÅ¼, bardzo waÅ¼ne.

**ÅK:** Tak. WiÄ™c to siÄ™ tam uspokoiÅ‚o. JeÅ¼eli sobie popatrzymy, jak mÃ³wimy troszeczkÄ™ o platformie, jeÅ¼eli tylko popatrzymy, to musimy dostarczyÄ‡ z takich rzeczy, tak jak ja mÃ³wiÄ™, dla aplikacji, do hostowania aplikacji, offering platformowy. No to dostarczasz tego wysoko dostÄ™pnego Kubernetesa, coÅ› do zbierania metryk.

**SW:** Musi byÄ‡.

**ÅK:** CoÅ› do zbierania logÃ³w.

**SW:** Tak, musi byÄ‡.

**ÅK:** JakiÅ› dashboard do wyÅ›wietlania. Dashboard w sensie metryk, logÃ³w, takiego monitoringu. I coÅ› do zarzÄ…dzania secretÃ³w. Tak. Bo CACD sÄ… pomysÅ‚y dziwne, na przykÅ‚ad, ktÃ³re sÄ…, latajÄ… sobie. Ja ich nie popieram, sÄ… rÃ³Å¼ne dziwne trzymania CACD na samym Kubernetesie. Ja tego nie popieram, wolÄ™ rzecz osobiÅ›cie, wolÄ™ narzÄ™dzia zewnÄ™trzne i nie zamykaÄ‡ siÄ™ w ogÃ³le na to.

**SW:** To przypomina mi trochÄ™ trend, jak pojawiÅ‚y siÄ™ mikroserwisy, to za chwilÄ™ pojawiÅ‚ siÄ™ trend nanoserwisy, czyli ludzie poszli z ideÄ… jeszcze dalej, bo myÅ›leli, Å¼e jak pomysÅ‚ pociÄ…gnÄ… za daleko, to bÄ™dzie dobrze, to teraz trzymamy wszystko w Kubernetesie - nie ma sensu. Tak. I Å¼e jak CACD i baza...

**ÅK:** Tak, do bazy przejdziemy, bo mam to w notatkach.

**SW:** Wiem, bo jest temat, ktÃ³ry mnie teÅ¼ bardzo interesuje i problematyczny.

**ÅK:** Tak, czyli patrzÄ…c siÄ™ na platformÄ™, to musimy wiedzieÄ‡, Å¼e Kubernetes to sÄ… klasyczne trzy warstwy pod spodem. To jest monolit, piÄ™kny monolit, jeÅ¼eli byÅ›my sobie na to popatrzyli. I zaczynajÄ…c od takich komponentÃ³w, no to wspomniaÅ‚eÅ› o bazach danych. Za wszystkim gdzieÅ› przychodzi przechowywany stan w Kubernetesie, za to jest odpowiedzialna etcd, ktÃ³ra ma swoje problemy i niuanse. To jest baza rozproszona, ktÃ³ra ma zapewniÄ‡ w miarÄ™ strong consistency i wykorzystuje teÅ¼ rafta, jest to Key-Value, no i ma swoje bottom leg. Im wiÄ™kszy klaster, tym ma troszkÄ™ niestety, przez to, Å¼e jest strong consistency, musi zwolniÄ‡ swoje odczyty, zapisy i pozwoliÄ‡ rozpropagowaÄ‡. Tam pod spodem dziaÅ‚a raft, protokuÅ‚ raft, jest implementacja rafta.

**SW:** SwojÄ… drogÄ… jakby ktoÅ› chciaÅ‚ zobaczyÄ‡, jak wyglÄ…da raft, to ja proponujÄ™ sobie postawiÄ‡ klaster Consula i tam bardzo Å‚adnie widaÄ‡, jak on siÄ™ degaduje, jak dziaÅ‚a.

**ÅK:** Ile czasu komunikacji w logach zajmuje? Ile czasu wymiana i komunikacja zajmuje?

**SW:** Tak. I np. ubiÄ‡ ktÃ³ryÅ› note i zobaczyÄ‡, jak on siÄ™ zachowa, kiedy generalnie nie ma konsensusu i tak dalej. Ale jak juÅ¼ ruszeÅ‚eÅ› z etcd, to jest problem, ktÃ³ry jest adresowany przez Microsoft, miÄ™dzy innymi, bo to jest profiler, w ktÃ³rym najwiÄ™cej siedzÄ™, to wÅ‚aÅ›nie jednak mimo wszystko jest elementem Cosmosa. No bo Cosmos zaczyna mieÄ‡ taki plug and play, kawaÅ‚ek. No skoro juÅ¼ masz Kubernetesa, to moÅ¼e nie etcd, tylko moÅ¼e weÅº w tym momencie Cosmosa, bo Cosmosa umiemy ogarnÄ…Ä‡ na poziomie lokalizacji, na poziomie geo i bÄ™dzie dziaÅ‚aÅ‚o dobrze.

**ÅK:** Tak. To jest takie pierwsze podejÅ›cie, drugi projekt, ktÃ³ry siÄ™ pojawiÅ‚, to uÅ¼ycie SQL Lite'a dla maÅ‚ych instalacji w K3, wÅ‚aÅ›nie od Rangera, wiÄ™c etcd jest tam odpowiedzialna za wszystko, jest takim centralnym punktem fakapÃ³w, to tak jak z back-upami, innymi rzeczami. Czy w teorii teÅ¼ powinniÅ›my jÄ… czyÅ›ciÄ‡, trochÄ™ mightnessu poÅ›wiÄ™ciÄ‡.

**SW:** Jak kaÅ¼da baza danych.

**ÅK:** NastÄ™pny zarzut, ktÃ³ry widzÄ™ trochÄ™ z perspektywy platformy, to jest brak perfect pair detection dla nodÃ³w.

**SW:** Dobrze, Å¼e dodaÅ‚eÅ› "perfect", bo bÄ™dÄ™ tu miaÅ‚ "ale".

**ÅK:** Tak, "ale". Teraz ja patrzÄ™ z poziomu platformy, nasze nody, czyli powiedziaÅ‚em, Å¼e Kubernetes jest trÃ³jwarstwowy. Czyli mamy sobie bazÄ™ danych, mamy ten centralny zestaw na masterze serwisÃ³w, gdzie gÅ‚Ã³wnym jest taki API server, przez ktÃ³rego przechodzÄ… wszystkie requesty. I dziaÅ‚a tak, Å¼e nasz wÄ™zeÅ‚ ze swoim agentem Qbletem, on wysyÅ‚a w jednÄ… stronÄ™ tylko strzaÅ‚y, puszcza tylko Heartbeat, Å¼e Å¼yje, wiÄ™c jeÅ¼eli wleci nam node, to nie dowiemy siÄ™ o tym szybko. No i mamy swoje czasy reakcji na to, co siÄ™ stanie i to troszeczkÄ™ moÅ¼e byÄ‡ bolÄ…czkÄ…, w szczegÃ³lnoÅ›ci jak Åºle zrobimy aplikacjÄ™.

**SW:** Tak, to jest taki trade off miÄ™dzy tym. Albo bÄ™dziemy bardzo czÄ™sto pytali siÄ™, dziÄ™ki czemu mamy szybkÄ… informacjÄ™, ale bÄ™dziemy system obciÄ…Å¼ali, albo generalnie pytamy siÄ™ rzadziej, ale obciÄ…Å¼amy mniej. Ja dodam znowu z punktu widzenia systemu, budowania systemÃ³w, to to, co daje Kubernetes, czyli on daje dwa probe'y. Liveness probe i readiness probe. Jedna mÃ³wi o tym, Å¼e OK, aplikacja Å¼yje, druga o tym, Å¼e moÅ¼emy przyjmowaÄ‡ requesty. To rozwiÄ…zuje 90% problemÃ³w na poziomie budowania aplikacji tak naprawdÄ™, wdroÅ¼eÅ„ przede wszystkim. I jak patrzÄ™, co potrzebujÄ…, to zgodzÄ™ siÄ™: wyÅ‚Ä…czenie jest waÅ¼ne, ale Å¼e mamy te dwa proby z pudeÅ‚ka, wystarcza na pierwszy rok-dwa lata developmentu wiÄ™kszoÅ›ci systemÃ³w.

**ÅK:** Ja patrzÄ™ wÅ‚aÅ›nie z poziomu platformy, nie aplikacji. Dla ciebie rozwiÄ…zaniem bÄ™dzie uÅ¼ycie, Å¼eby twoja inicjalna liczba podÃ³w, to byÅ‚y trzy czy cztery wÅ‚aÅ›nie instancje twojego serwisu i juÅ¼ dziÅ› masz szansÄ™, Å¼e zostanie to tak rozrzucone, Å¼e taka awaria wÅ‚aÅ›nie node'a ciÄ™ nie zÅ‚apie.

**SW:** I co wiÄ™cej, jak node siÄ™ przekrÄ™ca, to Å¼eby nagle nie trafiÅ‚o do niego sto requestÃ³w, tylko Å¼eby trafiÅ‚o dopiero jak bÄ™dzie readiness probe na OK, czyli on siÄ™ rozgrzeje, cash siÄ™ zbuduje, aplikacja siÄ™ zdÅ¼ituje i wszystko bÄ™dzie w porzÄ…dku. I tym moÅ¼na sterowaÄ‡ z punktu widzenia aplikacji. To jest dla mnie niesamowita wartoÅ›Ä‡.

**ÅK:** No i druga rzecz, ktÃ³ra mi siÄ™ trochÄ™ rzuca, to sÄ…, przy tym jak mÃ³wiÄ™, brak failure detection. Dla maÅ‚ych klastrÃ³w Kubernetes moÅ¼e byÄ‡ nie do koÅ„ca dobry, jak nie jesteÅ›my Å›wiadomi. Ze wzglÄ™du na bezwÅ‚adnoÅ›Ä‡ i sposÃ³b wÅ‚aÅ›nie dziaÅ‚ania.

**SW:** Dobrze. To zdefiniujmy maÅ‚e, bo maÅ‚e to jest bardzo wzglÄ™dne pojÄ™cie.

**ÅK:** Wiesz co? Ja powiem, czy zaboli ciÄ™ jak wyrzucisz 10-20% infrastruktury?

**SW:** OK!

**ÅK:** Bo jeÅ¼eli sobie popatrzymy przy skali, jeÅ¼eli wypadnie ci 10 serwerÃ³w ze 100, to nie ma tragedii. JeÅ¼eli wypadnie ci 50 z 500, tym bardziej nie ma tragedii, jeÅ¼eli wypadnie ci na przykÅ‚ad 2 z 10, ktÃ³re czÄ™sto zaczynajÄ… byÄ‡ dopchane...

**SW:** To zaczyna byÄ‡ ciekawie.

**ÅK:** Tak, wiÄ™c to bÄ™dzie dla mnie wÅ‚aÅ›nie ta skala, przez to, Å¼e wÅ‚aÅ›nie jest ten stan raportowany, to on powoduje trochÄ™ bezwÅ‚adnoÅ›ci.

**SW:** Tak, ale to trochÄ™ wraca do tego, co jest trochÄ™ moim przeczuciem, to czy na ile Kubernetes ma sens przy maÅ‚ych systemach? I tu mam bardzo mieszane uczucia.

**ÅK:** Wiesz co? Dobra, to z perspektywy platformy, weÅº as a service.

**SW:** I tak! Z tym siÄ™ w zupeÅ‚noÅ›ci zgadzam.

**ÅK:** Tam, gdzie mam okazjÄ™, przy jakiejÅ› mniejszych rozwiÄ…zaniach stosowaÄ‡ Kubernetesa, to on wÅ‚aÅ›nie twojÄ… perspektywÄ™, czyli dla dewelopera, deploymenty, probe'y, to rzeczy, ktÃ³re wprowadza do kultury pracy, naprawdÄ™ jest tego warte, ale nie jest warte tego utrzymywania.

**SW:** I teÅ¼ do tego wÅ‚aÅ›nie dÄ…Å¼Ä™, dokÅ‚adnie. PÅ‚acenie overheadu, utrzymania dla maÅ‚ych aplikacji - nie. Opis aplikacji - chciaÅ‚bym go mieÄ‡, bo to ma wartoÅ›Ä‡. I zgodzÄ™ siÄ™ w tym momencie, Å¼e as a service zdecydowanie ma ogromny sens.

**ÅK:** I druga rzecz, ktÃ³ra jest podkreÅ›lana przy Kubernetesie, jest to teÅ¼ sprzedaÅ¼ tego produktu, Å¼e dostajemy agnostycznoÅ›Ä‡ wzglÄ™dem infrastruktury i dostawcÃ³w. TrochÄ™ mÃ³wiÅ‚eÅ› o abstrakcji, wspominaliÅ›my na poczÄ…tku o abstrakcji z perspektywy aplikacji, ale dostajemy teÅ¼ dziÄ™ki temu wÅ‚aÅ›nie w teorii agnostycznoÅ›Ä‡ od dostawcÃ³w. Czyli moÅ¼emy sobie to odpaliÄ‡ gdziekolwiek, gdzie mamy wirtualizacjÄ™ plus jakiÅ› storage, ktÃ³ry jest sterowany.

**SW:** Tak.

**ÅK:** No i tutaj to jest fajne, ale trzeba siÄ™ nagÅ‚owiÄ‡.

**SW:** Tak, ale znowu wracamy do tego, co mÃ³wiliÅ›my na wczeÅ›niejszych odcinkach, Å¼e jeÅ¼eli zgadzamy siÄ™ z pewnym vendor lock-ingiem, czyli bierzemy as a service, to wiele problemÃ³w jest rozwiÄ…zanych. Jak chcemy byÄ‡ agnostyczni, to jest niÅ¼szy poziom API zgodnoÅ›ci i musimy siÄ™ bardzo nagÅ‚owiÄ‡.

**ÅK:** Tak, ale to dorzucÄ™ od siebie. Problemy, ktÃ³re widzÄ™ przy tej agnostycznoÅ›ci, z ktÃ³rymi ktoÅ› siÄ™ spotyka, budujÄ…c platformÄ™ np., czyli dostarczajÄ…c oferiting, gwarantujÄ…c, no to pierwsza rzecz, to bÄ™dzie jak zawsze sÅ‚ynna - sieÄ‡. No i w tym przypadku kaÅ¼dy vendrocloudowy ma swoje pluginy, one troszeczkÄ™ inaczej dziaÅ‚ajÄ…, trochÄ™ majÄ… innÄ… filozofiÄ™ dziaÅ‚ania. Ale takÄ… pierwszÄ…, z ktÃ³rÄ… siÄ™ stykamy od strony aplikacji, to sÄ… load balancery i sposÃ³b wystawiania tych aplikacji do Å›wiata czy do wewnÄ…trz firmy. I tam na przykÅ‚ad dotyka to juÅ¼ manifestu twojego, poniewaÅ¼ mamy anotacjÄ™. Na przykÅ‚ad load balancerem, pewne parametry load-balance, ustawienia na Å›wiat typu load balancer, Å¼e przed naszÄ… apkÄ… stoi ten juÅ¼ zewnÄ™trzny, publiczny czy prywatny load balancer. Tam sÄ… anotacje i trzeba juÅ¼ niestety coÅ› ruszyÄ‡ w aplikacji i wiedzieÄ‡ w opisie aplikacji, opisie serwisu, trzeba wiedzieÄ‡, jak to zrobiÄ‡, jeÅ¼eli wystawiamy bezpoÅ›rednio.

**SW:** ChoÄ‡ moÅ¼na to trzymaÄ‡ w osobnym pliku jbl-owym.

**ÅK:** No nie jest to w jbl-u, ale no niestety w tym manifeÅ›cie chodzi o to, Å¼e to nie bÄ™dzie tak, Å¼e grzebnÄ™ i przeniosÄ™. WeÅºmy najsÅ‚awniejszÄ… anotacjÄ™, czyli internal load balancer na true, opis w AWSie w Google'u i w tym, kaÅ¼dy ma swojÄ… oddzielnÄ… anotacjÄ™ w metadanych.

**SW:** Tak zgadza siÄ™. PrzenoszalnoÅ›Ä‡ jest z gwiazdkÄ…, mianowicie moÅ¼na przenieÅ›Ä‡, ale trzeba siÄ™ trochÄ™ nagÅ‚owiÄ‡.

**ÅK:** Dobra. NastÄ™pnÄ… rzeczÄ… bÄ™dzie storage. MÃ³wiÄ™ o storege'u: nie uÅ¼ywajcie! To jest od razu moja perspektywa, jak nie musicie, to nie uÅ¼ywajcie. No i tam znowu trafiamy w specyfikacjÄ™ easÃ³w, na ktÃ³rych to jest trzymane. Od dostawcÃ³w. Czyli weÅºmy na to z Ajourem bÄ™dÄ… problemy, sÄ… czasami jak node siÄ™ wywali czy ogÃ³lnie dÅ‚ugi czas przepinania dysku volumenu z jednego do drugiej maszyny. I to jest specyfika easu i koniec.

**SW:** Tak, ale ja w ogÃ³le jestem zdania, Å¼e korzystanie z dyskÃ³w, czyli interfejsu dyskowego w chmurze, no to od tego mamy bloba.

**ÅK:** Czy NFSa, tak. Ale ludzie czasem majÄ… pewne potrzeby, w szczegÃ³lnoÅ›ci, czy jak mÃ³wimy jeszcze o problemach, no to w AWSie sÄ… EBSy sÄ… per zona. Czyli jak masz znowu maÅ‚y klaster, to moÅ¼e siÄ™ zdarzyÄ‡, Å¼e nie ma gdzie siÄ™ przenieÅ›Ä‡ ten pode, bo w tej zonie juÅ¼ gdzie jest EBS od niego, nie ma juÅ¼ wÄ™zÅ‚a w tym momencie. I trzeba poczekaÄ‡, kiedy autorepair siÄ™ odpali. WiÄ™c to jest to. Druga rzecz troszeczkÄ™ z filozofii jest, to fajnie powiedziaÅ‚ Hightower z Google'a, Å¼e z Kubernetesem jest tak, to magnetycznoÅ›Ä‡, Å¼e byÄ‡ moÅ¼e odcinamy siÄ™ od ciekawych futere'Ã³w. Tak jak ty powiedziaÅ‚aÅ› o blobie, przed chwilÄ… wspomniaÅ‚eÅ›, Å¼e czasami siÄ™ nie zastanawiamy nad wziÄ™ciem gotowych API, ktÃ³re sÄ… dobre przez to, Å¼e siÄ™ w tym antyvendor lock-ingu zapinamy mentalnie, Å¼e bÄ™dziemy mieli agnostyczne.

**SW:** Tak, tak samo, jak chcieÄ‡ wymieniaÄ‡ bazy danych w trakcie dziaÅ‚ania i byÄ‡ nie zaleÅ¼nym, czy bÄ™dziemy chodzili na Oracle'u czy na SQL Serverze czy na MySQL.

**ÅK:** Czekaj, a to nie bajka o REMach?

**SW:** Cicho, cicho! Bajki sÄ… dobre w pewnym momencie Å¼ycia.

**ÅK:** Jak rzuciÅ‚eÅ› trochÄ™ z bazami danych i stanowoÅ›ciÄ…. I ogÃ³lnie tu siÄ™ na szczÄ™Å›cie zgadzamy. StanowoÅ›Ä‡, czyli statefule w Kubernetesie, sÄ… i to mocno.

**SW:** A ja skontrujÄ™ to: nieprawda. Ja dajÄ™ takÄ… zagadkÄ™ czÄ™sto na szkoleniach: co ma 50 lat i kaÅ¼dy ma to w swojej aplikacji? Baza relacyjna. Stateful sÄ… w kaÅ¼dym projekcie IT, bo nikt nie ma pomysÅ‚u jak to wdraÅ¼aÄ‡. Ta baza ma 50 lat i dalej nie mamy pomysÅ‚u jak robiÄ‡ upgrade'owe skrypty na przykÅ‚ad.

**ÅK:** Dobra, czyli ustalmy. MiÄ™dzy innymi trzymanie stanu - dla mnie to bÄ™dzie tak naprawdÄ™ baza danych albo coÅ›, co trzyma in memory i musi siÄ™ z replikowaÄ‡. WiÄ™c pierwszÄ… rzeczÄ… Kubernetes podchodzi do stanowoÅ›ci bardzo ciekawie i uproszczenie. Nie powiem, Å¼e luÅºno. UproÅ›cili bardzo. StanowoÅ›Ä‡ oznacza to, Å¼e ten stateful, kiedy nasza instancja wystartuje, jest do Å›mierci przypisana na jednej instancji. PrzykÅ‚adowo jeÅ¼eli wywaliÅ‚ siÄ™ node, to taka instancja nie zostanie nigdzie odpalona, dopÃ³ki jej nie skasujemy bÄ…dÅº nie skasujemy wÄ™zÅ‚a, na ktÃ³rym byÅ‚a. WiÄ™c ma swojÄ… wÅ‚aÅ›nie problematycznoÅ›Ä‡, a jeÅ¼eli uÅ¼yjemy deploymentÃ³w do postawienia bazy danych na przykÅ‚ad, czyli moÅ¼na pÃ³jÅ›Ä‡ (pisaÅ‚em na blogu artykuÅ‚ na temat Linkedin Driven Development), tam jest taki przykÅ‚ad czÅ‚owieka, ktÃ³ry mÃ³wi, Å¼e mu wszystko dziaÅ‚a i postawiÅ‚ bazÄ™ danych w State Klasie, ale mÃ³wi, Å¼e mu siÄ™ dysk przepina. WiÄ™c... to tak do koÅ„ca nie dziaÅ‚a, bo moÅ¼emy trafiÄ‡ na momenty konfliktÃ³w czy problemÃ³w. Czyli tak naprawdÄ™ polega to na tym, Å¼e mamy staÅ‚e miejsce, w ktÃ³rym bÄ™dzie ustawiony nasz serwis, i staÅ‚Ä… nazwÄ™. I to daje. No i to, co wspomniaÅ‚eÅ› wÅ‚aÅ›nie przy baza danych, jest to problematyczne. Problematyczne, wiÄ™c na dzieÅ„ dobry jeÅ¼eli mÃ³wimy, czy trzymaÄ‡ bazÄ™ danych w Kubernetesie? Na dzieÅ„ dobry powiem, Å¼e nie. I to jest takie dla wszystkich, ktÃ³rzy zaczynajÄ…, to jest nie, potem pojawia siÄ™ konsultanckie "to zaleÅ¼y".

**SW:** Tak. Ja z perspektywy oceny ryzyka projektÃ³w i Å‚atwoÅ›ci zarzÄ…dzania tym, teÅ¼ mÃ³j default jest "nie". Czemu? Bo ja - by default - powiem "Zacznij od bazy relacyjnej", to jest dobry punkt, Å¼eby gdzieÅ› pÃ³jÅ›Ä‡ w innym kierunku. A relacyjna w Kubernetesie - moÅ¼e tak niekoniecznie.

**ÅK:** Dobra. I tutaj jest sobie coÅ› takiego, jest post Google'a, ktÃ³ry dobrze to pokazuje, problemy, overheady... Jest na temat, czy odpalaÄ‡ czy nie odpalaÄ‡ te bazy danych w Kubernetesie. I jest tak Å¼e jest gros baz, ktÃ³re sÄ… gotowe na dziaÅ‚anie w takim statefulu, ktÃ³ry daje Kubernetes. RzucajÄ…c: MongoDB, Cassandra, czyli bazy, ktÃ³re posiadajÄ… wÅ‚asnÄ… replikacjÄ™ i wÅ‚asny konsensus.

**SW:** I nie majÄ… rotacji rozproszonych i nie sÄ… wysoko spÃ³jne.

**ÅK:** Tak. Czyli takie bazy moÅ¼emy czy Elastica z duÅ¼Ä… iloÅ›ciÄ… replik, moÅ¼emy moÅ¼emy wÅ‚aÅ›nie odpaliÄ‡ w Kubernetesie. Jest to jeden z przykÅ‚adÃ³w i wtedy moÅ¼na siÄ™ zastanowiÄ‡, jeÅ¼eli juÅ¼ umiemy tego statelessa, Å¼eby zrozumieÄ‡ statefula i problemy, ktÃ³re idÄ…. I to wtedy zadziaÅ‚a. Jest jeszcze takie jedno "ale", o ktÃ³ry mÃ³wi GCP, Å¼eby uÅ¼ywaÄ‡ teÅ¼ baz danych, ktÃ³re majÄ… (jeÅ¼eli juÅ¼ chcemy korzystaÄ‡) operatorÃ³w. Czym jest operator? WyjaÅ›nimy zaraz. Jest sobie custom resource definition, czyli manifest, o ktÃ³rym powiedziaÅ‚aÅ›. Ty moÅ¼esz zbudowaÄ‡ wÅ‚asne obiektyw Kubernetesie. Nie tylko moÅ¼esz rozszerzyÄ‡ jego funkcjonalnoÅ›Ä‡, czyli dodaÄ‡ swoje nowe metadane, nowe opisy dla swoich usÅ‚ug. I jak jest realizowane? No wÅ‚aÅ›nie. MoÅ¼na napisaÄ‡ sobie serwis, instancje, Å¼yjÄ…tko, ktÃ³re bÄ™dzie przypinaÅ‚o siÄ™ do Kubernetesa i wykonywaÅ‚o jakieÅ› akcje na podstawie tych custom resource definition, naszych obiektÃ³w. I przy bazach danych dziaÅ‚a to w ten sposÃ³b, Å¼e wrzucamy opis, Å¼e ja chcÄ™ teraz bazÄ™ danych o takiej nazwie, z takim silnikiem, takie parametry. I on z tego generuje deployment i utrzymuje jego stan na klastrze, zarzÄ…dza upgradem i innymi rzeczami. I wtedy to ma sens. PrzykÅ‚adem nawet z relacyjnych, ktÃ³re wchodzÄ… i sÄ… rozwiÄ…zania, na przykÅ‚ad jest Postgres od Crunchy na Kubernetesa, ktÃ³ry wÅ‚aÅ›nie jest tak sterowany. Czy nawet Failover jest sterowany przez operator. Czy w Microsofcie teraz SQL Server 2019 z Always On'em - teÅ¼ bÄ™dzie dostarczony operator, Å¼eby odpaliÄ‡ klastry Always On enterprise'owe na Kubernetesie.

**SW:** Max to w ogÃ³le sporo zainwestowaÅ‚ w Always Ona na SQL Serverze. On siÄ™ w ciÄ…gu otatnich czterech lat doÅ›Ä‡ mocno pozmieniaÅ‚ i dziaÅ‚a duÅ¼o lepiej.

**ÅK:** Tak, jest wsparcie na Linuxie i nastÄ™pnÄ… rzecz teÅ¼ bÄ™dÄ… uÅ¼ywaÄ‡, jest to w Preview, zaraz pewnie wyjdzie, w ciÄ…gu kilku-kilkunastu tygodni, na przestrzeni tego jeszcze roku wyjdzie do produkcji. WiÄ™c moÅ¼na zdeployowaÄ‡ sobie, wpisujemy, Å¼e chciaÅ‚bym tego SQL Server w nasz obiekt manifestu, wÅ‚aÅ›nie, Å¼e chciaÅ‚bym takÄ… bazÄ™ danych. I taki operator, jak zobaczy taki obiekt, jak siÄ™ pojawi, to to deployuje. I to jest teÅ¼ ciekawa rzecz, wÅ‚aÅ›nie rozszerzalnoÅ›Ä‡ tego opisu, czyli moÅ¼na dodawaÄ‡ do Kubernetesa swoje wÅ‚asne rzeczy.

**SW:** Do sprÃ³bowania, jak najbardziej. Dobrze, to chyba czas nas goni, trzeba to zwrapowaÄ‡. Twoje dwie myÅ›lisz czy ileÅ› myÅ›li, ktÃ³re chciaÅ‚byÅ›, Å¼eby byÅ‚y wyniesione z tego?

**ÅK:** Dobrze. To pierwsza jest taka: jak robisz pojedynczÄ… aplikacjÄ™, uÅ¼yj gotowych rozwiÄ…zaÅ„. JeÅ¼eli chodzi o Kubernetesa, jeÅ¼eli chcesz go uÅ¼yÄ‡, to do 100 wÄ™zÅ‚Ã³w nie zastanawiaj siÄ™, weÅº wszystko, co daje ci operator. JeÅ¼eli zaczynasz i nie wiesz, co chcesz osiÄ…gnÄ…Ä‡, weÅº gotowe rzeczy, czyli gotowy monitoring, metryki, zarzÄ…dzanych klaser przez Vendora.

**SW:** To trochÄ™ wraca do tego, co powiedzieliÅ›my przy agile generalnie, szybki czas do dziaÅ‚ania. Tak, zgadzamy siÄ™.

**ÅK:** Tak, bo stoi tam parÄ™ rzeczy. No i koniecznÄ… rzeczÄ…, jeÅ¼eli teÅ¼ zaczynasz, robisz lub na tym Kubernetes siÄ™ z statelessy. W peÅ‚ni Å›wiadomie rÃ³b statelessy. Bazy danych na start trzymaj sobie poza klastrem. MogÄ… byÄ‡ to zwykÅ‚e VMki, jeÅ¼eli potrafisz w Immutable IaaS - super. JeÅ¼eli nie potrafisz, to sprÃ³bu, zacznij z database as a service. JeÅ¼eli Å¼Ä…dasz tej agnostycznoÅ›ci, no to uÅ¼yj Postgresa czy MySQLa, ktÃ³ry jest dostÄ™pny  tak naprawdÄ™ na wiÄ™kszoÅ›ci topowych cloudÃ³w as a servise.

**SW:** Czyli podsumowujÄ…c, to start simple and complicate things as you move on. No, zgadzalibyÅ›my siÄ™. To ja dorzucÄ™ swoje dwie rzeczy - z punktu "Czemu warto?", bo uwaÅ¼am, Å¼e zdecydowanie Kubenetesa warto, mimo Å¼e ma jakieÅ› swoje problemy. Dla samych deploymentÃ³w - warto, opisu Å›rodowisk, opisu caÅ‚ych systemÃ³w przede wszystkim - warto, zdecydowanie, bo to jest taki pierwszy opis, ktÃ³rzy deweloperzy wykorzystujÄ… i moÅ¼e byÄ‡ Å‚adnie przekazany potem do deploymentu i uÅ¼ywany caÅ‚y czas. WchodzÄ™ w projekt, widzÄ™ pliki Kubernetesowe, odpalam aplaya i caÅ‚y system mi dziaÅ‚a. To jest fenomenalne. Druga myÅ›l, ktÃ³ra nawiÄ…zuje bardzo mocno do twoich maÅ‚ych systemÃ³w, to jest to, Å¼eby pamiÄ™taÄ‡ o tym o overheadzie. Å»eby nagle nie stwierdziÄ‡, Å¼e "O! Mam moje trzy instancje, trzy serwisy, ktÃ³re ze sobÄ… rozmawiajÄ… raz na jakiÅ› czas, to uÅ¼yjÄ™ Kubernetesa i bÄ™dzie wszystko chodziÅ‚o szybciej i lepiej". Overhead istnieje, nie jest tani. BÄ™dzie siÄ™ zmieniaÅ‚o. Ale to trzeba mnie zawsze z tyÅ‚u gÅ‚owy, bo za to pÅ‚acimy sporo. Ale warto, Å¼eby byÅ‚o pozytywnie.

**ÅK:** Tak, warto, na tÄ… chwilÄ™ warto.

**SW:** Zdecydowanie. KoÅ„czymy?

**ÅK:** KoÅ„czymy! Na razie!

**SW:** Na razie!
