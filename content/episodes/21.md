---
title: '#21 Observability - Metryki
'
date: 2020-01-31T08:00:00+02:00
episode: "21"
tags: []
description: ""

# Jekyll compatibility fields (zachowane dla innych systemÃ³w)  
spreaker: 22582755
apple: "https://podcasts.apple.com/us/podcast/observability-metryki/id1477067604?i=1000464217231"
spotify: "https://open.spotify.com/episode/https://open.spotify.com/episode/1LvqfuG4S2ChhayWAi2FVg"
youtube: ""

# Hugo fields  
youtube_id: "https://www.youtube.com/watch?v=AzsqcMemUiA"
youtube_url: "https://www.youtube.com/embed/https://www.youtube.com/watch?v=AzsqcMemUiA?enablejsapi=1"

# Social media images (poprawione nazwy)
og_landscape: "/img/21-landscape.webp"
og_square: "/img/21-square.webp"

# Intro for episode
intro: |
  Kolejnym z filarÃ³w observability sÄ… metryki, na ktÃ³rych skupimy siÄ™ w tym odcinku. Jest to najbardziej potrzebny element do proaktywnego monitoringu i baza do tworzenia ulubionych przez wszystkich alertÃ³w ;-)
  

# Links for the episode
links:
  - title: "Make resilient Go net/http servers using timeouts, deadlines and context cancellation"
    url: "https://ieftimov.com/post/make-resilient-golang-net-http-servers-using-timeouts-deadlines-context-cancellation/"
  - title: "Path to a Software Architect"
    url: "https://github.com/justinamiller/SoftwareArchitect"
  - title: "Monitoring and Observability â€” What&#39;s the Difference and Why Does It Matter?"
    url: "https://thenewstack.io/monitoring-and-observability-whats-the-difference-and-why-does-it-matter/"
  - title: "UserVoice"
    url: "https://github.com/patoarchitekci/uservoice/issues"
  - title: "Count and sum of observations"
    url: "https://prometheus.io/docs/practices/histograms/#count-and-sum-of-observations"
  - title: "InfluxDB"
    url: "https://www.influxdata.com/"
  - title: "Understanding Observability"
    url: "https://sdarchitect.blog/2020/01/08/understanding-observability/"
  - title: "Prometheus"
    url: "https://prometheus.io/"
  - title: "Monitoring and Observability with USE and RED"
    url: "https://www.vividcortex.com/blog/monitoring-and-observability-with-use-and-red"

# Newsletter content (zachowane dla kompatybilnoÅ›ci)
newsletter: |
  CzeÅ›Ä‡! ğŸ‘‹ âœ¨
  
  Kolejnym z filarÃ³w observability sÄ… metryki, na ktÃ³rych skupimy siÄ™ w tym odcinku. Jest to najbardziej potrzebny element do proaktywnego monitoringu i baza do tworzenia ulubionych przez wszystkich alertÃ³w ;-)
  
  
  
  
  ## Odcinek na stronie i materiaÅ‚y do niego â¬‡ï¸
  
  â¡ï¸ [OdsÅ‚uchaj na stronie](https://patoarchitekci.io/21)
  â¡ï¸ [Spotify](https://open.spotify.com/episode/https://open.spotify.com/episode/1LvqfuG4S2ChhayWAi2FVg)
  â¡ï¸ [Apple Podcasts](https://podcasts.apple.com/us/podcast/observability-metryki/id1477067604?i=1000464217231)
  â¡ï¸ [YouTube](#)
  
  ## Short & Sweet
  

  ### ğŸ¤ DoÅ‚Ä…cz do Discord ğŸ‘‰ [https://discord.gg/78zPcEaP22](https://discord.gg/78zPcEaP22)
  
  ### ğŸ¢ Patron odcinka
  SÅ‚uchasz PatoarchitektÃ³w dziÄ™ki PROTOPII â€“ firmie, w ktÃ³rej Åukasz i Szymon dziaÅ‚ajÄ… na co dzieÅ„, wspierajÄ…c zespoÅ‚y IT na kaÅ¼dym etapie: od projektowania, przez wdroÅ¼enia i migracje, aÅ¼ po optymalizacjÄ™ i zabezpieczenia. Oferujemy teÅ¼ mentoring i szkolenia dostosowane do potrzeb kaÅ¼dej firmy, niezaleÅ¼nie od wielkoÅ›ci. SprawdÅº nas: [protopia.tech](https://protopia.tech/)
  
  PS. Masz pytania? Pisz Å›miaÅ‚o po drugiej stronie to nie bot na bazie GPT czy Claude ğŸ˜
---

**Åukasz:** CzeÅ›Ä‡. SÅ‚uchacie PatoarchitektÃ³w. ProwadzÄ… Åukasz KaÅ‚uÅ¼nyâ€¦

**Szymon:** â€¦i Szymon Warda. Wszystkie linki do tego odcinka znajdziecie na www.patoarchitekci.io/21 . To od linkÃ³w zaczynamy?

**Å:** Tak, od linkÃ³w. Co przygotowaÅ‚eÅ›?

**S:** ZnalazÅ‚em ciekawe repo na GitHubie, doÅ›Ä‡ duÅ¼e, niekodowe. Bardzo cieszÄ™ siÄ™, Å¼e je znalazÅ‚em, bo czÄ™sto dostajÄ™ pytania od osÃ³b, ktÃ³re chciaÅ‚yby albo chcÄ… zostaÄ‡ architektami.

**Å:** Albo pytajÄ… siÄ™, co to jest.

**S:** Ewentualnieâ€¦

**Å:** â€co to za zwierzÄ™".

**S:** StarajÄ… siÄ™ zostaÄ‡ architektami i nagle jest pytanie â€co ja wÅ‚aÅ›ciwie powinienem robiÄ‡ i jak wyglÄ…da ta praca". Ta praca jest zupeÅ‚nie inna niÅ¼ na przykÅ‚ad developera, team leadera â€“ zupeÅ‚nie inna bajka. To repo jest ciekawe, bo listuje czÄ™ste aktywnoÅ›ci leadera i tam tego kodowania jest duÅ¼o mniej, a potem proponuje takÄ… pÄ™tlÄ™ zwrotnÄ… zdarzeÅ„: design, decide, simplified code, document, communicate, estimate, estimate & evaluate, balance, consult & coach. I na koÅ„cu market. Mnie tu cieszÄ… bardzo trzy pozycje: simplify â€“ bo czÄ™sto ludzie to zapamiÄ™tajÄ…, szczegÃ³lnie kiedy majÄ… opcjÄ™ â€Budujemy to sÅ‚ynne opus magnum". Communicate â€“ bo wielu deweloperÃ³w ma tendencjÄ™ do tego, Å¼eby jednak zamknÄ…Ä‡ siÄ™ w swoim pokoju i generalnie tylko kodowaÄ‡: â€ZobaczÄ… moje wspaniaÅ‚e dzieÅ‚o". Wreszcie consult & coach â€“ bo elementem pracy, obowiÄ…zkÃ³w developera powinno byÄ‡ wÅ‚aÅ›nie coachowanie i tak naprawdÄ™ trenowanie swojego nastÄ™pcy. 

**Å:** To, co mi siÄ™ akurat w tym podoba to, Å¼e w consult & coach jest open door session, czyli jest siÄ™ dostÄ™pnym. To jest jedno. Drugie pewnie ten communicate bym u Ciebie zamieniÅ‚ na â€balance", ktÃ³ry tu siÄ™ znajduje, ale to juÅ¼ z mojej praktyki.

**S:** Tak, moÅ¼liwe. Jeszcze o market myÅ›laÅ‚em, bo to teÅ¼ jest czÄ™sto rzecz, o ktÃ³rej zapominamy jako architekci. To jest waÅ¼ne, Å¼eby jednak reklamowaÄ‡ te rozwiÄ…zania, czy one sÄ… dobre. To jest waÅ¼ne.

**Å:** WielkoÅ›Ä‡ organizacji.

**S:** Zdecydowanie.

**Å:** Przy tym projekcie, w ktÃ³rym ja siedzÄ™, to akurat balance i consult & coach sÄ… najbardziej istotne przy aktywnoÅ›ciach, bo to bardziej aktywnoÅ›Ä‡ niÅ¼ projekt.

**S:** Ja ostatnio coraz wiÄ™cej mam potrzeby jednak tego â€market".

**Å:** Jedna rzecz mi siÄ™ w tym nie podoba. Tak zarzucÄ™ do obejrzenia, ten technology road map jest chyba na siÅ‚Ä™ wrzucona. I ksiÄ…Å¼ki.

**S:** Jest parÄ™ obszarÃ³w, ktÃ³re nie sÄ… idealne, zgodzÄ™ siÄ™. Ale powiem tak: gdybym ten link miaÅ‚ rok temu, to duÅ¼o by obsÅ‚uÅ¼yÅ‚ takich wÅ‚aÅ›nie pytaÅ„. Na start? Super.

**Å:** Super. Important skills na pewno, a reszta z przymruÅ¼eniem oka.

**S:** PamiÄ™taj, Å¼e patrzysz z innej perspektywy. Na start dla kogoÅ›, kto siÄ™ w tej roli znajduje, sporo z tego wyniesie. Ciekawe. Dobrze. Co u Ciebie?

**Å:** A ja dla odmiany trochÄ™ miÄ™cha i bebechÃ³w od Twojego. Post na temat tworzenia w Golangu, uÅ¼ywania tak naprawdÄ™, wbudowanej klasy HTTP serwera w sposÃ³b resilient, czyli wysoko, niezawodnie dostÄ™pny. I jest pokazane na temat podstaw, ktÃ³re trzeba pamiÄ™taÄ‡. Tu sÄ… dwie. Jeden to sÄ… â€time-outy", drugieâ€¦

**S:** Circuit breaker?

**Å:** Nie. context cancellation, bo to od strony implementacji serwera.

**S:** Tak. CaÅ‚kiem fajna rzecz.

**Å:** WiÄ™c tutaj jest to wprowadzone, w jakiÅ› sposÃ³b to wyglÄ…da w Golangu. Nie oszukujmy siÄ™ â€“ w wiÄ™kszoÅ›ci jÄ™zykÃ³w wyglÄ…da to bardzo podobnie, bo zaczyna siÄ™ od tego, Å¼e mamy piÄ™knie pokazane graficzne przedstawianie czym jest time-out i jak w ogÃ³le trwa taki caÅ‚y cykl requestu, ktÃ³ry mamy, Å¼adania do serwera.

**S:** NaprawdÄ™ caÅ‚kiem nieÅºle i faktycznie jeszcze fajnie zwizualizowane. NiezÅ‚y wpis. Dobrze, to o czym dziÅ›?

**Å:** To wracamy do **observability**. Tym razem metryki. Szymon, przypomnijmy sobie, uporzÄ…dkujmy to podejÅ›cie. Powiedz nam te trzy kluczowe obszary **observability**.

**S:** **Logi**, w poprzednim odcinku, **metryki** i na koÅ„cu mamy **tracing**.

**Å:** Mamy **metryki**. W dwÃ³ch zdaniach powiedz nam, czym jest **metryka**.

**S:** To jest akurat proste. Jest to para klucz-wartoÅ›Ä‡, gdzie klucz jest stylingiem, a wartoÅ›Ä‡ jest liczbÄ…. Tyle.

**Å:** Dobrze. Za mocno to uproÅ›ciÅ‚eÅ›. Tak na moje, zapomniaÅ‚eÅ› jeszcze o czasie. 

**S:** Specjalnie, bo tak naprawdÄ™ ten czas jest generowany czÄ™sto albo przez system do agregowania logÃ³w albo ten system do przechowywania tych logÃ³w. Tam ten czas siÄ™ dopiero znajduje, dodatkowy wymiar. 

**Å:** PrzejdÅºmy: mamy system agregujÄ…cy i przetwarzajÄ…cy w kontekÅ›cie metryk. RozwiÅ„ to, bo troszkÄ™ robi to taki maÅ‚y â€mindfuck".

**S:** Tak.

**Å:** Tutaj mÃ³wisz â€agregujÄ…cy i przetwarzajÄ…cy". Czy to nie powinno byÄ‡ jednÄ… caÅ‚oÅ›ciÄ…? 

**S:** WÅ‚aÅ›nie. CzÄ™sto jest tak, Å¼e metryki, ktÃ³re generujemy, to jest duÅ¼o danych. I w duÅ¼ych systemach, gdzie je generujemy jest ich doÅ›Ä‡ sporawo. Stawia siÄ™ czÄ™sto po drodze, czy miÄ™dzy naszym systemem te metryki generuje albo z ktÃ³rego zbieramy metryki, a bazÄ… danych, ktÃ³ra je przechowuje. Jest coÅ› takiego co siÄ™ nazywa **statsd**. Prosta aplikacja, ktÃ³ra co robi? Zbiera te \***metryki**, **agreguje** i w pewnym okienku czasowym je upraszcza, uÅ›rednia, Å¼eby jednak tych metryk wysyÅ‚anych do naszego serwera, ktÃ³ry je przetwarza, Å¼eby byÅ‚o ich mniej, bo po prostu byÅ›my sobie nie poradzili z tym volumenem danych. 

**Å:** MoÅ¼na uproÅ›ciÄ‡. Tak jest na przykÅ‚adzie statsd, czyli jest to klocek, ktÃ³ry tak naprawdÄ™ robi za proxy, za bufor, przed wejÅ›ciem.

**S:** Tak.

**Å:** ByÄ‡ moÅ¼e mieÄ‡ kawaÅ‚ek logiki. A przetwarzajÄ…cy to juÅ¼ jest ta **baza time series**, ktÃ³ra przechowuje metryki. 

**S:** DokÅ‚adnie tak.

**Å:** To mamy. Metryki tak naprawdÄ™ nie sÄ… tak proste, jak powiedziaÅ‚eÅ›.

**S:** Nie sÄ… proste.

**Å:** Tak.

**S:** KomplikujÄ… siÄ™ wÅ‚aÅ›nie. CzÄ™sto, co widzÄ™ u deweloperÃ³w to jest to, Å¼e jakÄ…Å› metrykÄ™, klucz-wartoÅ›Ä‡, zapominajÄ… o tym elemencie, tym wymiarze czasu. Czyli tym, co siÄ™ stanie za ta metrykÄ… jak zaczniemy zawÄ™Å¼aÄ‡ nasze okienko. Prosty przykÅ‚ad: patrzymy na okienko, gdzie sÄ… kolejki 10-sekundowe. Czyli te 10 sekund upraszczamy do jednego punktu i jak w tych 10 sekundach mamy na przykÅ‚ad trzy pomiary, to co siÄ™ z nimi stanie? To juÅ¼ przestaje byÄ‡ takie trywialne, bo to co daje nam Grafana to, Å¼e moÅ¼emy patrzeÄ‡ na wymiar czasu, co siÄ™ dziaÅ‚o w systemie w godzinie w ostatnim roku. Wiadomo, Å¼e w tym momencie te liczby bÄ™dÄ… wyglÄ…daÅ‚y inaczej, co siÄ™ z nimi powinno dziaÄ‡.

**Å:** Dobrze. To zacznijmy sobie od tych typÃ³w pod spodem i od najprostszego, jakÄ… jest metryka typu counter. 

**S:** To brzmi jako najprostsza wartoÅ›Ä‡. Aplikacja wysyÅ‚a wartoÅ›Ä‡ dodatniÄ… lub ujemnÄ…, dodatnia podbija niejako licznik, ujemna zmniejsza ten licznik. OczywiÅ›cie, time grain, czyli to czym jest statsd, to jest ten obszar okienka, ktÃ³ry bÄ™dziemy upraszczali. BÄ™dziemy te metryki squashowali do jednej wartoÅ›ci. W tym momencie dajemy informacjÄ™ do naszego systemu, Å¼e w tym okienku naleÅ¼y zsumowaÄ‡ te wartoÅ›ci. 

**Å:** Teraz bardzo waÅ¼ne. **statsd** jest utrzymywany po stronie aplikacji, ktÃ³ra wysyÅ‚a, bo powiedziaÅ‚eÅ›, Å¼e zincrementowany bÄ…dÅº zmniejszany.

**S:** Tak. Bo aplikacja de facto wysyÅ‚a wartoÅ›Ä‡, a tÄ… sumÄ™ ogarniajÄ… systemy dalsze. Aplikacja nie musi siÄ™ martwiÄ‡, co siÄ™ dzieje. De facto, aplikacja wysyÅ‚a takÄ… wartoÅ›Ä‡ relatywnÄ…, nie absolutnÄ….

**Å:** OK. MoÅ¼esz daÄ‡ jakiÅ› przykÅ‚ad?

**S:** Jasne. PrzykÅ‚adem, ktÃ³ry ja widzÄ™, to jest: patrzymy na stan elementÃ³w w magazynie. Systemy, ktÃ³re przyjmujÄ… rzeczy do magazynu zwiÄ™kszajÄ… liczniki, systemy, ktÃ³re wydajÄ… albo monitorujÄ… cokolwiek, w tym momencie te liczniki zmniejszajÄ…. To sÄ… dwa osobne systemy. One nie majÄ… dostÄ™pu do tego samego, ale dziÄ™ki temu , Å¼e podbijajÄ… albo zmniejszajÄ… tÄ™ samÄ… metrykÄ™, my mamy stan absolutny w danej sytuacji. To jest fajne. 

**Å:** To mamy podstawowo omÃ³wiony system jakim jest counter. NastÄ™pny jest **gauge**.

**S:** Tu patrzymy trochÄ™ inaczej. Musimy bardziej spojrzeÄ‡ na to, jak taka metryka jest odczytywana. W tym momencie ma ona wiÄ™kszy sens. To jest metryka, ktÃ³rej wartoÅ›Ä‡ jest rÃ³wna ostatniej aktualnej wartoÅ›ci. NiewaÅ¼ne, czy to zaraportowanie wartoÅ›ci byÅ‚o 5 sekund temu czy 2 godziny temu. Po prostu patrzymy na ostatniÄ… wartoÅ›Ä‡. PrzykÅ‚ad: liczba podÃ³w w cubermetresie. Praktycznie ta wartoÅ›Ä‡ siÄ™ nie zmienia, pÃ³ki nie zostanie niezaraportowana ta zmiana, czyli counter tu nie ma Å¼adnego znaczenia. Wiemy, Å¼e jak 10 minut temu byÅ‚a taka sama wartoÅ›Ä‡, to nic siÄ™ nie zmieniÅ‚o do tego czasu. Tu jest jedna uwaga: raportowanie metryki typu gauge wymaga znajomoÅ›ci stanu absolutnego systemu. Na przykÅ‚ad w cubermetrisie mamy kogo siÄ™ zapytaÄ‡ i mamy tÄ™ informacjÄ™.

**Å:** Czyli musimy znaÄ‡ realnie ten stan, Å¼eby siÄ™ prawidÅ‚owo o to dopytaÄ‡.

**S:** DokÅ‚adnie.

**Å:** Dobrze. Teraz dorzuÄ‡my sobie trochÄ™ wymiarÃ³w czasowych i bardziej skomplikowanych do tych metryk, czyli histogram.

**S:** Dobrze. Czym jest histogram? Histogram jest rozkÅ‚adem iloÅ›ciowym wartoÅ›ci po jakimÅ› wymiarze. W histogramie czÄ™sto naszym wymiarem jest wymiar czasowy. To jest bardzo waÅ¼ne. Typowy przykÅ‚ad histogramu: czasy odpowiedzi dla danego requestu, czyli widzimy jak on siÄ™ rozkÅ‚adaÅ‚ i jakie sÄ… ramy czasu. Na przykÅ‚ad, odpowiedzieliÅ›my w ciÄ…gu 3 sekund dla 200 requestÃ³w, a dla 3,5 sekundy na przykÅ‚ad 2,500 requestÃ³w. To daje nam zdrowie systemÃ³w w skali czasu, ale bardziej interesuje nas nie jak siÄ™ zmieniaÅ‚o w czasie, tylko rozkÅ‚ad. Histogram pewnie kaÅ¼dy kiedyÅ› widziaÅ‚ na jakimÅ› obrazku.

**Å:** Czyli mamy histogram. Drugi podobny tryb metryki to summary, czyli podsumowanie.

**S:** Tak. Summary jest takÄ… obudÃ³wkÄ… wokÃ³Å‚ histogramu, bo dodaje konfigurowalne percentyle. Tak naprawdÄ™ mÃ³wimy, Å¼e okej, jak juÅ¼ sÅ‚yszymy o percentylach to oczywiÅ›cie nam siÄ™ kojarzy z SLA, SLO itd. Bardzo sÅ‚usznie. Mamy w SLA, SLO ustalone, Å¼e system ma odpowiadaÄ‡ w danym czasie w 95 przypadkach requestÃ³w. Summary wÅ‚aÅ›nie nam to daje: czy jest w porzÄ…dku czy trochÄ™ gorzej wyglÄ…damy. To jest bardzo waÅ¼ny wykres do monitorowania i wizualizacji. JeÅ¼eli mamy jakikolwiek SLA albo my korzystamy z tego SLA, co jest waÅ¼ne, albo my wystawiamy SLA.

**Å:** Czyli tak naprawdÄ™ dla nas SLO - Service Level Objective. Dobrze. Jak jesteÅ›my przy metrykach, przy tych detalach, jest jeszcze coÅ› takiego jak gradacja z czasem rozdzielczoÅ›ci.

**S:** Tak. To siÄ™ bardzo mocno wiÄ…Å¼e z tym, co statsd robi. Mianowicie, metryki jako takie to sÄ… klucz-wartoÅ›Ä‡, wiÄ™kszoÅ›Ä‡ systemÃ³w potrafi przyjmowaÄ‡ dziesiÄ…tki tysiÄ™cy metryk na sekundÄ™. Tych danych zaczyna siÄ™ trochÄ™ robiÄ‡. NastÄ™pne pytanie to czy chcemy te wszystkie dane zbieraÄ‡ i kolejne to na ile waÅ¼ne i na ile wartoÅ›ciowe sÄ… metryki sprzed roku w rozdzielczoÅ›ci co 100 milisekund. MajÄ… raczej wÄ…tpliwÄ… wartoÅ›Ä‡. WiÄ™c wiÄ™kszoÅ›Ä‡ systemÃ³w Influx umie to robiÄ‡, Prometheus nie. Umie metryki niejako degradowaÄ‡, jakoÅ›Ä‡ tych metryk, czyli zmniejsza ich rozdzielczoÅ›Ä‡. Na przykÅ‚ad, w dniu dzisiejszym mamy co 100 milisekund, po tygodniu mamy co 500 milisekund, a po roku widzimy tÄ™ rozdzielczoÅ›Ä‡ w przedziale minuty. To bardzo oszczÄ™dza storage i przyspiesza zapytania.

**Å:** Ja siÄ™ po roku akurat przyzwyczaiÅ‚em do dniowych albo tygodniowych, przy niektÃ³rych rzeczach capacity. 

**S:** Tak czÄ™sto moÅ¼e byÄ‡. To jest juÅ¼ do ustalenia.

**Å:** Dobrze, teraz punkt, przy ktÃ³rym miÄ™dzy sobÄ… ustalaliÅ›my co my przez to rozumiemy, bo kaÅ¼dy nazywaÅ‚ to inaczej. Ja powiedziaÅ‚em to o evencie, Szymon o adnotacjach. WiÄ™c czym sÄ… adnotacje, co jest prawidÅ‚owÄ… nazwÄ… przy metrykach. Czym jest adnotacja, jak patrzymy na metryki observability?

**S:** Po pierwsze: tyle wygraÄ‡, Å¼eby Åukaszowi udowodniÄ‡ â€“ yes! Po drugie: czym sÄ… adnotacje. Adnotacje sÄ… kolejnym featurem, ktÃ³ry widzÄ™, Å¼e jest czÄ™sto zapominany, bez ktÃ³rego patrzenie na metryki dla mnie traci bardzo duÅ¼o wartoÅ›ci. PrzykÅ‚ad z Å¼ycia: jak zaczynamy wdroÅ¼enie nowej wersji na produkcjÄ™ albo na jakiekolwiek Å›rodowisko, wiemy, Å¼e CPU nam podskoczy. Jak teraz bÄ™dziemy patrzyli na nasze wykresy patrzÄ…c tydzieÅ„ wstecz, widzimy, Å¼e byÅ‚ Spike w CPU i we wszystkim. Jednak on jest oczekiwany. Czym sÄ… zatem adnotacje? Adnotacje sÄ… wizualnie pionowymi liniami albo przedziaÅ‚ami czasowymi, gdzie moÅ¼emy powiedzieÄ‡: â€Okej, tu siÄ™ coÅ› zaczÄ™Å‚o dziaÄ‡, tu siÄ™ coÅ› skoÅ„czyÅ‚o dziaÄ‡" i patrzÄ…c na wykresy moÅ¼emy je wizualizowaÄ‡. To jest takie adnotowanie czasu i historii, co siÄ™ wtedy dziaÅ‚o, i tÅ‚umaczenie potomnym. Bardzo przydatna informacja.

**Å:** Czyli pokazanie tego zdarzenia. StÄ…d mieliÅ›my tÄ… dyskusjÄ™, bo pokazujemy jakieÅ› zdarzenie, ktÃ³re zaszÅ‚o w systemie i ma realny wpÅ‚yw na monitoring, ktÃ³ry mÃ³wi, Å¼e â€W tym momencie albo w ogÃ³le na to nie patrz, bo bÄ™dzie czerwona przez najbliÅ¼sze 10-15 minut, albo zacznij od tego miejsca â€“ to jest miejsce, gdzie wprowadziliÅ›my zmiany w konfiguracji, o! poszÅ‚o do gÃ³ry, daliÅ›my ciaÅ‚a".

**S:** Tak. Teraz przykÅ‚ady: mamy start release'u â€“ tam jest konieczna adnotacja. PrzedziaÅ‚y od kiedy do kiedy jest dana wersja, na przykÅ‚ad start  nowej wersji â€“ to teÅ¼ jest w porzÄ…dku. To sÄ… naprawdÄ™ przydatne wartoÅ›ci, bo tego nie bÄ™dziemy pamiÄ™tali. Chyba, Å¼e chcemy przechodziÄ‡ przez rÃ³Å¼ne docsy i patrzeÄ‡ po  ticketach w Jira czy w czymkolwiek innym, kiedy byÅ‚y releas'y i co siÄ™ dziaÅ‚o. Te rzeczy powinny byÄ‡ jak najbardziej na metrykach. Koniec kropka.

**Å:** Dobrze. To jeszcze dorzucÄ™, bo byÅ‚a dyskusja. Czyli powinniÅ›my mieÄ‡ adnotacje na pewno na release'y. 

**S:** Na pewno na release'y.

**Å:** Start / Stop release'u.

**S:** Tak.

**Å:** â€¦i Å¼e jest nowa wersja dziaÅ‚ajÄ…ca na produkcji jako juÅ¼ nie przedziaÅ‚, tylko po prostu znacznik.

**S:** Tak.

**Å:** Dobrze. Co z **circuit breakerem**? To jest **metryka** czy **adnotacja**, jeÅ¼eli zmieni siÄ™ jego stan?

**S:** To jest metryka. Zdecydowanie. 

**Å:** Dobrze.

**S:** Czemu? Bo metryki sÄ… uproszczone, nie majÄ… w tym momencie wszystkich operacji matematycznych, a przy circuit-breakerze mamy prosty myk. Metryka jest porÃ³wnywana globalnie, na dany przedziaÅ‚ czasowy, to jest adnotacja do czasu. JeÅ¼eli mamy jednak parÄ™ instancji typu circuti-breaker'a to chcemy wiedzieÄ‡, gdzie siÄ™ otwieraÅ‚y. I tego adnotacjami juÅ¼ byÅ›my nie zrobili. Dlatego metryka.

**Å:** Dobrze. Teraz pÃ³jdÅºmy do kolejnej, ciekawej rzeczy jakÄ… w metrykach jest nie zawsze do koÅ„ca zÅ‚apana. Prometheus doÅ›Ä‡ dobrze to wymusza w pewnych miejscach â€“ tagowanie metryk.

**S:** WytÅ‚umaczÄ™ teÅ¼, czemu to jest czasem niewymagane. Metryki historycznie idÄ…c od Grafite'a nie miaÅ‚y tagÃ³w. Dopiero Influx i Prometheus to wprowadziÅ‚. Tagowanie â€“ bardzo waÅ¼ne. Te informacje wokÃ³Å‚ tego, z czego metryka wynika, czego dotyczy i jakiej grupy. Jest seria tagÃ³w, ktÃ³re po prostu muszÄ… byÄ‡. Åšrodowisko, instancja, nazwa i rola tej metryki â€“ generalnie, co ona wÅ‚aÅ›ciwie peÅ‚ni. Takie ogÃ³lne informacje, Å¼e jak ktoÅ› spojrzy, to wie, gdzie to umieÅ›ciÄ‡ i co wiÄ™cej, dorwaÄ‡ wszystkie metryki danej kategorii, Å›rodowiska itd. ZnaczÄ…co poprawia widocznoÅ›Ä‡. 

**Å:** To ja dorzucÄ™ od siebie jeszcze dobrÄ… praktykÄ™. Warto te same tagi trzymaÄ‡ przy logach. To potrafi duÅ¼o pomÃ³c, jeÅ¼eli robimy analizÄ™, tudzieÅ¼ Å‚adnie tÅ‚umaczÄ…c na polski - Å›ledztwo", bo moÅ¼emy zobaczyÄ‡ i to ze sobÄ… zÅ‚Ä…czyÄ‡; co siÄ™ dziaÅ‚o, kiedy te logi wystÄ™powaÅ‚y. W Å›wiecie Cloud Native teraz jak sobie popatrzymy na Prometheusa oraz nowÄ… zabawkÄ™ z tamtej rodziny, czyli Logiego do zbierania logÃ³w. One majÄ… wÅ‚aÅ›nie te metryki z pudeÅ‚ka, pozwalajÄ… na otagowanie tak samo metryk jak i logÃ³w, tymi samymi parametrami. 

**S:** To jest to, o czym mÃ³wiliÅ›my w poprzednim odcinku. To jest dodanie kontekstu do logÃ³w, co jest bardzo, bardzo waÅ¼ne. CzÄ™sto rzeczy typu rozdzielenie Å›rodowisk w logach robi siÄ™ przez inne indeksy Elastic Search'a. Ale tak jeÅ¼eli bierzemy logi? Jak najbardziej.

**Å:** Teraz prosta rzecz, ale szybka: push czy pull?

**S:** Jedno i drugie. Dlaczego? Z serwerÃ³w bÄ™dziemy zawsze pullowali, ale jak chcemy wysÅ‚aÄ‡ metryki z aplikacji, to bÄ™dziemy je pushowali, bo w tym momencie dajemy wiÄ™kszy kontekst i wiemy, co mamy zrobiÄ‡. A jak dochodzimy do wysyÅ‚ania metryk z aplikacji, to dochodzimy do rozdzielenia bardzo waÅ¼nego, miÄ™dzy metryki techniczne a biznesowe.

**Å:** WÅ‚aÅ›nie, bo mamy metryki techniczne i biznesowe. W teorii techniczne wydajÄ… siÄ™ prostsze.

**S:** W teorii tak, ale rzÄ…dza siÄ™ wiÄ™kszym baÅ‚aganem. Metryka biznesowa, uporzÄ…dkujmy co przez to rozumiemy, bo teÅ¼ mieliÅ›my caÅ‚kiem dÅ‚ugÄ… dyskusjÄ™, jest metryka rozumiana przez manager'a nietechnicznego Å›redniego szczebla.

**Å:** OkreÅ›liliÅ›my sobie ten level odciÄ™cia jako Å›redni szczebel.

**S:** Tak. KtoÅ›, kto przychodzi i spojrzy na wykres czy cokolwiek i bÄ™dzie wiedziaÅ‚ czy jest okej i czy dla niego wartoÅ›ci, ktÃ³re system wypluwa sÄ… w porzÄ…dku. To waÅ¼ne. CzÄ™sto te metryki biznesowe sÄ… zawarte w SLA naszej umowy, w kontraktach, itd.

**Å:** Tak. Takiej osobie jest Å‚atwo zobaczyÄ‡, czy speÅ‚niamy kontrakt albo siÄ™ zbliÅ¼amy. MogÄ… to byÄ‡ czasy odpowiedzi, czÄ™sto iloÅ›Ä‡ przetworzonych dokumentÃ³w.

**S:** WaÅ¼ne: dokumentÃ³w, a nie wywoÅ‚anych requestÃ³w. Zgadza siÄ™.

**Å:** Ja jeszcze dodam do metryki biznesowej, przy finansÃ³wce mamy doÅ›Ä‡ ciekawÄ… rzecz, jeÅ¼eli mamy system pÅ‚atnoÅ›ci, to czy nam siÄ™ salda na kontach zgadzajÄ….

**S:** Tak.

**Å:** Czy iloÅ›Ä‡ wpÅ‚ywÃ³w, ktÃ³re powinny byÄ‡ zgadza siÄ™ z tym, co faktycznie wpÅ‚ynÄ™Å‚o. To teÅ¼ ciekawie porzÄ…dkuje.

**S:** Wiesz, trochÄ™ tak bilansujÄ™ miÄ™dzy metrykÄ… a health-checkiem, ale zgodzÄ™ siÄ™, Å¼e jeÅ¼eli moÅ¼emy w czasie rzeczywistym monitorowaÄ‡, to jak najbardziej powinniÅ›my. 

**Å:** Dobrze. To mamy. To jeszcze pierwsze podejÅ›cie do monitoringu, w szczegÃ³lnoÅ›ci metryk technicznych. Jest coÅ›, co od jakiegoÅ› czasu zdobywa popularnoÅ›Ä‡, co nazywa siÄ™ RED. Czym jest ten RED?

**S:** Monitorowaniem wejÅ›cie / wyjÅ›cie, procent i procent wyjÄ…tku. Czyli wszystko, co moÅ¼emy zbieraÄ‡ w trywialny sposÃ³b, od dowolnego serwera HTTP albo dowolnego systemu, ktÃ³ry przyjmuje wiadomoÅ›ci. To mamy niemal zawsze z pudeÅ‚ka. 

**Å:** Czyli tak naprawdÄ™ bierzemy sobie logi z reverse prox, metryki z reverse proxu od Balancer'a. Proxy to wystawiajÄ… cudownie teraz w tych formatach.

**S:** Wszyscy to wystawiajÄ….

**Å:** Tak. Serwery aplikacyjne, czy ciekawe, bo ten RED tÅ‚umaczy siÄ™ na Request Error Duration, tak samo moÅ¼emy to wziÄ…Ä‡ z kolejki IN / OUT.

**S:** Dobrze, Å¼e to poruszyÅ‚eÅ›, bo czÄ™sto ludzie zapominajÄ… o tym, Å¼e kolejka teÅ¼ jest waÅ¼nym elementem do monitorowania, a ta moÅ¼e naprawdÄ™ ciekawe rzeczy wyciÄ…gnÄ…Ä‡. My wÅ‚aÅ›nie ostatnio monitorowaliÅ›my doÅ›Ä‡ sporo i ciekawostki wyszÅ‚y w kontekÅ›cie Rabbita.

**Å:** Za dÅ‚ugo leÅ¼Ä…ce?

**S:** Nie, niepotwierdzone wiadomoÅ›ci w Rabbicie bedÄ… przetworzone dopiero, kiedy serwer siÄ™ rozÅ‚Ä…czy. Ta-dam! 

**Å:** Mamy juÅ¼ metryki techniczne i biznesowe. Teraz ostatnia rzecz, bo powiedzieliÅ›my, Å¼e przy logach nie robimy alertÃ³w i metryki sÄ… tym miejscem. 

**S:** Przy metrykach zdecydowanie robimy alerty. Metryki biznesowe, ktÃ³re zdefiniowaliÅ›my, mogÄ… wynikaÄ‡ z metryk technicznych. Mamy dane techniczne, mapuje siÄ™ to na metrykÄ™ biznesowÄ…. WiÄ™c na biznesowych musimy, bo to potencjalnie pÅ‚acimy za maÅ‚o pÅ‚acimy za duÅ¼o, albo ktoÅ› za chwilÄ™ zapuka i powie, Å¼e: â€No chÅ‚opaki, mamy problem, bo tmy musimy komuÅ› zapÅ‚aciÄ‡ wiÄ™cej". W technicznych, Å¼eby broniÄ‡ siÄ™ od realnych problemÃ³w i to monitorowaÄ‡, czy aplikacja Å¼yje czy czas odpowiedzi, takie podstawowe rzeczy, Å¼ebyÅ›my wiedzieli, czy jest ona zdatna do pracy i czy wiemy co robi.

**Å:** MoÅ¼na na tym bardzo Å‚atwo zaobserwowaÄ‡, przy alertach w ogÃ³le i przy wykresach moÅ¼na zobaczyÄ‡ wtedy degradacjÄ™ systemu jak i potem jego awarie. 

**S:** Tak. Co waÅ¼ne, dziÄ™ki wÅ‚aÅ›nie takim zachowaniom moÅ¼emy Å‚adnie sobie scrollowaÄ‡, bÄ™dziemy siÄ™ caÅ‚y czas uczyli tego, jak te alerty robiÄ‡. To nie jest, Å¼e raz konfigurujemy i one bÄ™dÄ… caÅ‚y czas aktualne. To jest coÅ›, co bÄ™dzie zawsze ewoluowaÅ‚o razem z aplikacjÄ….

**Å:** W kontekÅ›cie alertÃ³w bardzo warto dodaÄ‡ anomality detection jak i caÅ‚y machine-learning, ktÃ³ry moÅ¼e siÄ™ pojawiÄ‡ na metrykach, ktÃ³ry siÄ™ pojawia w produktach czasowych.

**S:** On siÄ™ pojawiÅ‚ i naprawdÄ™ jest fajny. Czym wÅ‚aÅ›ciwie jest anomality detection? 

**Å:** OdchyÅ‚em od normy. NaprawdÄ™ wykryciem odchyÅ‚u od normy tego, jak nasz system dziaÅ‚a.

**S:** Tak.

**Å:** Na bazie wytrenowanego modelu na naszych metrykach.

**S:** To jest hiper waÅ¼ne, bo czÄ™sto widzimy, Å¼e metryki sÄ… zapinane na wartoÅ›ci absolutnej, na przykÅ‚ad na liczbÄ™ bÅ‚Ä™dÃ³w. Nie oszukujmy siÄ™ â€“ nie ma takiej aplikacji, ktÃ³ra nie rzucaÅ‚aby raz na jakiÅ› czas bÅ‚Ä™dem. To nie jest powÃ³d, Å¼eby robiÄ‡ on-calla, zbieraÄ‡ siÄ™, Å¼e system za chwilÄ™ wybuchnie. Problem pojawia siÄ™, jak nasz system rzuca nagle duÅ¼o wiÄ™cej bÅ‚Ä™dÃ³w niÅ¼ normalnie w tym samym czasie rzucaÅ‚. I to bardzo fajny cache robi tzw. Smash detection w application insides.

**Å:** Tak. W Microsoft to jest Smart Detection.

**S:** MuszÄ™ powiedzieÄ‡, Å¼e korzystam. DziaÅ‚a dobrze.

**Å:** Tak. MiesiÄ…c nauki na produkcji i zaczyna wysyÅ‚aÄ‡ przydatne alerty.

**S:** I naprawdÄ™ sensowne i jak coÅ› siÄ™ faktycznie dzieje.

**Å:** Czas na podsumowanie.

**S:** Dobre praktyki â€“ jest ich kilka. To co ja praktykujÄ™ to jest, Å¼e jeÅ¼eli mamy metryki, to miejmy teÅ¼ dokument, ktÃ³ry opisuje, ktÃ³ra metryka co znaczy. Z caÅ‚ym szacunkiem, ale po nazwie i tagu, jakbyÅ›my wpisywali to nie bÄ™dzie aÅ¼ tak czytelne po pÃ³Å‚ roku czasu. 

**Å:** Przy czym dokument ma nie straszyÄ‡. Nazwa metryki i w jaki sposÃ³b jest wyliczana. 

**S:** Tak. I skÄ…d siÄ™ bierze. ChociaÅ¼by Microsoft to fajnie opisuje w counterach: jest to doÅ›Ä‡ nieÅºle zrobione. 

**Å:** Potem sobie popatrzymy na przykÅ‚adowe dashboardy, bo z wizualizacjami zawsze jest problem. 

**S:** Co wiÄ™cej, one powodujÄ… mniejszy prÃ³g wejÅ›cia, Å¼eby ludzie zaczÄ™li korzystaÄ‡, szczegÃ³lnie przy biznesowych. 

**Å:** RÃ³bmy proste rzeczy, wzorujmy siÄ™ na tym, co polecaliÅ›my np. RED, bo tam jest jeden dashboard dla kaÅ¼dej usÅ‚ugi, wiÄ™c warto zobaczyÄ‡ i wzorujÄ…c siÄ™ weÅº gotowe dashboardy dla jakiÅ› rozwiÄ…zaÅ„ typu MySQL, Postgres, Kubernetes czy Prometheus. Zobacz jak taki dashboard naprawdÄ™ fajnie wyglÄ…da i skopiuj go do swoich rzeczy, bo one dobrze pokazujÄ…, jak jest monitorowane takie rozwiÄ…zanie. 
**S:** CieszÄ™ siÄ™, Å¼e to powiedziaÅ‚eÅ›, bo teraz dochodzimy do innego obszaru, ktÃ³ry teÅ¼ staramy siÄ™ mocno promowaÄ‡. To jest, Å¼eby na jednym dashboardzie mieÄ‡ wiele data source'Ã³w. Dlaczego? PoniewaÅ¼ mamy rÃ³Å¼ne ÅºrÃ³dÅ‚a prawdy. PrzykÅ‚ad: moÅ¼emy mieÄ‡ raportowanie, ile nasza aplikacja przyjÄ™Å‚a albo ile razy woÅ‚aÅ‚ siÄ™ handler aplikacyjny. Drugi wykres mamy na tym samym dashboardzie, na przykÅ‚ad jak duÅ¼a jest kolejka, ile razy byÅ‚o potwierdzeÅ„, ile byÅ‚o wiadomoÅ›ci. Czyli weryfikujemy, Å¼e wartoÅ›ci, ktÃ³re powinny byÄ‡ takie same sÄ… czy nie sÄ…. CzÄ™sto te wartoÅ›ci nie bÄ™dÄ… takie same i nagle dowiemy siÄ™ czegoÅ› nowego, jak nasz system w ogÃ³le dziaÅ‚a. 

**Å:** Kolejna rzecz: metryki to nie audyt. Jest to doÅ›Ä‡ istotne do zrozumienia, Å¼e metryki sÅ‚uÅ¼Ä… do zaobserwowania i monitorowania, a nie do audytowania.

**S:** Tak. Z czym ja siÄ™ spotkaÅ‚em to, Å¼e biznesowe metryki byÅ‚y widziane jako wartoÅ›ci absolutne i powiedzmy, Å¼e z iloÅ›ci przetwarzanych dokumentÃ³w byÅ‚y na przykÅ‚ad inne dziaÅ‚y rozliczane i co siÄ™ tam dzieje, itd. PamiÄ™tajmy, Å¼e wiÄ™kszoÅ›Ä‡ metryk leci po UDP, mogÄ… byÄ‡ tam bÅ‚Ä™dy, moÅ¼emy gubiÄ‡ pakiety i to jest coÅ› co bÄ™dziemy upraszczali, szczegÃ³lnie w pierwszym okresie czasowym po wdroÅ¼eniu. Tam bÄ™dziemy mieli sporo bÅ‚Ä™dÃ³w, takÅ¼e to nie jest audyt.

**Å:** OstatniÄ… rzeczÄ… bÄ™dzie skalowanie na bazie metryk. 

**S:** Bardzo waÅ¼ne. Co moÅ¼emy robiÄ‡? To w sumie pojawia siÄ™ w chmurach autoscaling up-serwisÃ³w, Å¼e moÅ¼emy zmieniaÄ‡ zachowanie naszego systemu w zaleÅ¼noÅ›ci od tego, co siÄ™ dzieje nie po iloÅ›ci kolejki na http, tylko od systemÃ³w duÅ¼o wczeÅ›niejszych, ile mamy wiadomoÅ›ci w kolejce, gdzie znajÄ…c proces biznesowy moÅ¼emy robiÄ‡ bardziej reaktywne zachowanie caÅ‚ego systemu i skalowanie infrastruktury.

**Å:** CieszÄ™ siÄ™, Å¼e powiedziaÅ‚eÅ› â€biznesowy", bo dla mnie genialnÄ… rzeczÄ… przy bazie metryk kiedy bÄ™dziemy implementowaÄ‡ pierwsze biznesowe, niekiedy to bÄ™dzie iloÅ›Ä‡ requestÃ³w na sekundÄ™, ale moÅ¼emy przestaÄ‡ skalowaÄ‡ infrastrukturÄ™ po zuÅ¼yciu CPU i RAMu w wielu miejscach.

**S:** CPU to jest wynik jakiegoÅ› dziaÅ‚ania, wiÄ™c jak reagujemy na samo CPU to jest trochÄ™ za pÃ³Åºno na to, Å¼eby cokolwiek siÄ™ wydarzyÅ‚o. Wtedy mamy problem. WiÄ™c to skalowanie siÄ™ duÅ¼o wczeÅ›niejsze na wczeÅ›niejszych elementach systemu robi robotÄ™. 

**Å:** Dobra, koÅ„czymy.

**S:** KoÅ„czymy? DziÄ™ki wielkie. Hej!

**Å:** DziÄ™ki. Na razie!
